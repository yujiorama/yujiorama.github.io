<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<meta name="author" content="Daniel Dietrich, Robert Winkler">
<title>Vavr User Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Vavr User Guide</h1>
<div class="details">
<span id="author" class="author">Daniel Dietrich, Robert Winkler</span><br>
<span id="revnumber">version 0.10.3,</span>
<span id="revdate">2021-09-06</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_初めに">1. 初めに</a>
<ul class="sectlevel2">
<li><a href="#_java_8_と_vavr_で関数型データ構造を扱う">1.1. Java 8 と Vavr で関数型データ構造を扱う</a></li>
<li><a href="#_関数型プログラミング">1.2. 関数型プログラミング</a>
<ul class="sectlevel3">
<li><a href="#_副作用">1.2.1. 副作用</a></li>
<li><a href="#_参照透過性">1.2.2. 参照透過性</a></li>
<li><a href="#_値について考える">1.2.3. 値について考える</a></li>
</ul>
</li>
<li><a href="#_データ構造入門">1.3. データ構造入門</a>
<ul class="sectlevel3">
<li><a href="#_可変データ構造">1.3.1. 可変データ構造</a></li>
<li><a href="#_不変データ構造">1.3.2. 不変データ構造</a></li>
<li><a href="#_永続データ構造">1.3.3. 永続データ構造</a></li>
</ul>
</li>
<li><a href="#_関数型データ構造">1.4. 関数型データ構造</a>
<ul class="sectlevel3">
<li><a href="#_連結リスト">1.4.1. 連結リスト</a></li>
<li><a href="#_キュー">1.4.2. キュー</a></li>
<li><a href="#_順序付きセット">1.4.3. 順序付きセット</a></li>
</ul>
</li>
<li><a href="#_最先端のコレクション">1.5. 最先端のコレクション</a>
<ul class="sectlevel3">
<li><a href="#_並び">1.5.1. 並び</a></li>
<li><a href="#_セット_set_とマップ_map">1.5.2. セット（Set）とマップ（Map）</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_vavr_入門">2. Vavr 入門</a>
<ul class="sectlevel2">
<li><a href="#_gradle">2.1. Gradle</a></li>
<li><a href="#_maven">2.2. Maven</a></li>
<li><a href="#_スタンドアローン">2.3. スタンドアローン</a></li>
<li><a href="#_スナップショット">2.4. スナップショット</a>
<ul class="sectlevel3">
<li><a href="#_gradle_2">2.4.1. Gradle</a></li>
<li><a href="#_maven_2">2.4.2. Maven</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_利用ガイド">3. 利用ガイド</a>
<ul class="sectlevel2">
<li><a href="#_タプル">3.1. タプル</a>
<ul class="sectlevel3">
<li><a href="#_タプルの作成">3.1.1. タプルの作成</a></li>
<li><a href="#_タプルの要素ごとにマップする">3.1.2. タプルの要素ごとにマップする</a></li>
<li><a href="#_タプル全体をマップする">3.1.3. タプル全体をマップする</a></li>
<li><a href="#_タプルを変換する">3.1.4. タプルを変換する</a></li>
</ul>
</li>
<li><a href="#_関数">3.2. 関数</a>
<ul class="sectlevel3">
<li><a href="#_合成">3.2.1. 合成</a></li>
<li><a href="#_引き上げ">3.2.2. 引き上げ</a></li>
<li><a href="#_部分適用">3.2.3. 部分適用</a></li>
<li><a href="#_カリー化">3.2.4. カリー化</a></li>
<li><a href="#_メモ化">3.2.5. メモ化</a></li>
</ul>
</li>
<li><a href="#_値">3.3. 値</a>
<ul class="sectlevel3">
<li><a href="#_option">3.3.1. Option</a></li>
<li><a href="#_try">3.3.2. Try</a></li>
<li><a href="#_lazy">3.3.3. Lazy</a></li>
<li><a href="#_either">3.3.4. Either</a></li>
<li><a href="#_future">3.3.5. Future</a></li>
<li><a href="#_validation">3.3.6. Validation</a></li>
</ul>
</li>
<li><a href="#_コレクション">3.4. コレクション</a>
<ul class="sectlevel3">
<li><a href="#_リスト">3.4.1. リスト</a></li>
<li><a href="#_ストリーム">3.4.2. ストリーム</a></li>
<li><a href="#_性能特性">3.4.3. 性能特性</a></li>
</ul>
</li>
<li><a href="#_プロパティチェック">3.5. プロパティチェック</a></li>
<li><a href="#_パターンマッチ">3.6. パターンマッチ</a>
<ul class="sectlevel3">
<li><a href="#_java_におけるパターンマッチの基本">3.6.1. Java におけるパターンマッチの基本</a></li>
<li><a href="#_さまざまなパターン">3.6.2. さまざまなパターン</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_license">4. License</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_初めに">1. 初めに</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vavr (formerly called Javaslang) is a functional library for Java 8+ that provides persistent data types and functional control structures.</p>
</div>
<div class="paragraph">
<p>Vavr（正式名称は Javaslang）は、Java 8 以降の Java に、永続データ構造と関数型の制御構造を導入するライブラリです。</p>
</div>
<div class="sect2">
<h3 id="_java_8_と_vavr_で関数型データ構造を扱う">1.1. Java 8 と Vavr で関数型データ構造を扱う</h3>
<div class="paragraph">
<p>Java 8’s <a href="https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html">lambdas (λ)</a> empower us to create wonderful API’s. They incredibly increase the expressiveness of the language.</p>
</div>
<div class="paragraph">
<p>Java 8 で導入された <a href="https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html">ラムダ式（λ式）</a>は素敵なAPIを作成するのに役立ちます。<br>
ラムダ式は Java 言語の表現力を劇的に向上してくれました。</p>
</div>
<div class="paragraph">
<p><a href="http://vavr.io/">Vavr</a> leveraged lambdas to create various new features based on functional patterns. One of them is a functional collection library that is intended to be a replacement for Java’s standard collections.</p>
</div>
<div class="paragraph">
<p><a href="http://vavr.io/">Vavr</a> はラムダ式を活用して、関数型プログラミングのパターンに基づくさまざまな新しい機能を導入します。<br>
中には Java の標準コレクションを置き換える関数型のコレクションライブラリも含みます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/vavr-collections.png" alt="Vavr Collections">
</div>
</div>
<div class="paragraph">
<p><em>(This is just a bird’s view, you will find a human-readable version below.)</em></p>
</div>
<div class="paragraph">
<p><em>(これは俯瞰的な図ですが、後で人間に読める大きさの文字にした図を紹介します。)</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_関数型プログラミング">1.2. 関数型プログラミング</h3>
<div class="paragraph">
<p>Before we deep-dive into the details about the data structures I want to talk about some basics. This will make it clear why I created Vavr and specifically new Java collections.</p>
</div>
<div class="paragraph">
<p>データ構造の詳細を説明する前に、いくつか基本知識を説明していきます。<br>
そうすれば、なぜ Vavr を開発したのか、特に Java のコレクションを置き換えることにしたのか理解できるでしょう。</p>
</div>
<div class="sect3">
<h4 id="_副作用">1.2.1. 副作用</h4>
<div class="paragraph">
<p>Java applications are typically plentiful of <a href="https://en.wikipedia.org/wiki/Side_effect_(computer_science)">side-effects</a>. They mutate some sort of state, maybe the outer world. Common side effects are changing objects or variables <em>in place</em>, printing to the console, writing to a log file or to a database. Side-effects are considered <em>harmful</em> if they affect the semantics of our program in an undesirable way.</p>
</div>
<div class="paragraph">
<p>普通なら、Java アプリケーションにはさまざまな <a href="https://en.wikipedia.org/wiki/Side_effect_(computer_science)">副作用</a> があるものです。<br>
内部状態だけでなく、外界を変化させる場合もあります。<br>
一般的に副作用と言えば、<em>その場の</em>オブジェクトや変数を変化させることや、コンソールへ文字を出力すること、ログファイルやデータベースへデータを書き込むことが挙げられます。<br>
プログラムの意図しない方法で、想定するセマンティクスに影響を与えることから、副作用は<em>有害なもの</em>だと考えられています。</p>
</div>
<div class="paragraph">
<p>For example, if a function throws an exception and this exception is <em>interpreted</em>, it is considered as side-effect that <em>affects our program</em>. Furthermore <a href="http://c2.com/cgi/wiki?DontUseExceptionsForFlowControl">exceptions are like non-local goto-statements</a>. They break the normal control-flow. However, real-world applications do perform side-effects.</p>
</div>
<div class="paragraph">
<p>例えば、ある関数が<em>スレッドへの割り込み</em>により例外を送出した場合、それは<em>プログラムに影響を与える</em>副作用だと考えられます。<br>
また、 <a href="http://c2.com/cgi/wiki?DontUseExceptionsForFlowControl">例外は大域的なGOTO文（みたいなもの）</a>で、正常な制御フローを中断させてしまいます。<br>
しかし、実世界のアプリケーションはそのような副作用を活用しているのです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">int</span> divide(<span class="type">int</span> dividend, <span class="type">int</span> divisor) {
    <span class="comment">// divisor が 0 のとき例外を送出します</span>
    <span class="keyword">return</span> dividend / divisor;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In a functional setting we are in the favorable situation to encapsulate the side-effect in a Try:</p>
</div>
<div class="paragraph">
<p>関数型のプログラミングスタイルは、副作用を Try にカプセル化することを推奨します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// = Success(result) or Failure(exception)</span>
Try&lt;<span class="predefined-type">Integer</span>&gt; divide(<span class="predefined-type">Integer</span> dividend, <span class="predefined-type">Integer</span> divisor) {
    <span class="keyword">return</span> Try.of(() -&gt; dividend / divisor);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This version of divide does not throw any exception anymore. We made the possible failure explicit by using the type Try.</p>
</div>
<div class="paragraph">
<p>書き直した divide 関数は例外を送出しません。<br>
潜在的な失敗を、Try 型で明示的に記述できるようになったのです。</p>
</div>
</div>
<div class="sect3">
<h4 id="_参照透過性">1.2.2. 参照透過性</h4>
<div class="paragraph">
<p>A function, or more generally an expression, is called <a href="https://en.wikipedia.org/wiki/Referential_transparency">referentially transparent</a> if a call can be replaced by its value without affecting the behavior of the program. Simply spoken, given the same input the output is always the same.</p>
</div>
<div class="paragraph">
<p>プログラムの振る舞いに副作用を与えることなく、その呼び出しを値へ置き換えることができる関数、あるいは、より一般化した式のことを、 <a href="https://en.wikipedia.org/wiki/Referential_transparency">参照透過性</a>がある、と表現します。<br>
言い換えると、同じ入力を与えると常に同じ結果を返すということです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// 参照透過性がありません</span>
<span class="predefined-type">Math</span>.random();

<span class="comment">// 参照透過性があります</span>
<span class="predefined-type">Math</span>.max(<span class="integer">1</span>, <span class="integer">2</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>A function is called <a href="https://en.wikipedia.org/wiki/Pure_function">pure</a> if all expressions involved are referentially transparent. An application composed of pure functions will most probably <em>just work</em> if it compiles. We are able to reason about it. Unit tests are easy to write and debugging becomes a relict of the past.</p>
</div>
<div class="paragraph">
<p>参照透過性のある式および関数で構成された関数を <a href="https://en.wikipedia.org/wiki/Pure_function">純粋</a>関数と呼びます。<br>
純粋関数だけで構成したアプリケーションは、コンパイルができればほとんどの場合<em>ちゃんと</em>動作します。<br>
その理由は推測可能です。<br>
ユニットテストを簡単に書けるようになり、デバッグ技法は過去の遺物になったことです。</p>
</div>
</div>
<div class="sect3">
<h4 id="_値について考える">1.2.3. 値について考える</h4>
<div class="paragraph">
<p>Rich Hickey, the creator of Clojure, gave a great talk about <a href="https://www.youtube.com/watch?v=-6BsiVyC1kM">The Value of Values</a>. The most interesting values are <a href="https://en.wikipedia.org/wiki/Immutable_object">immutable</a> values. The main reason is that immutable values</p>
</div>
<div class="ulist">
<ul>
<li>
<p>are inherently thread-safe and hence do not need to be synchronized</p>
</li>
<li>
<p>are stable regarding <em>equals</em> and <em>hashCode</em> and thus are reliable hash keys</p>
</li>
<li>
<p>do not need to be cloned</p>
</li>
<li>
<p>behave type-safe when used in unchecked covariant casts (Java-specific)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Clojure言語の開発者であるRich Hickeyが、 <a href="https://www.youtube.com/watch?v=-6BsiVyC1kM">値の価値</a>について素晴らしいプレゼンテーションを公開しています。<br>
最も興味深いのは <a href="https://en.wikipedia.org/wiki/Immutable_object">不変</a>の値（オブジェクト）です。<br>
不変の値は次のような性質を備えています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>本質的にスレッド安全なので、同期が不要</p>
</li>
<li>
<p><em>equals</em> と <em>hashCode</em> も不変になるので、ハッシュ値（キー）が信頼できる</p>
</li>
<li>
<p>複製を作らなくてよい</p>
</li>
<li>
<p>Java 特有の、共変型への強制型変換（キャスト）が未チェックでも、型安全に振る舞う</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The key to a better Java is to use <em>immutable values</em> paired with <em>referentially transparent functions</em>.</p>
</div>
<div class="paragraph">
<p>より良い Java には<em>不変の値</em>と<em>参照透過な関数</em>の組み合わせが必要不可欠です。</p>
</div>
<div class="paragraph">
<p>Vavr provides the necessary <a href="http://static.javadoc.io/io.vavr/vavr/0.10.3/io/vavr/control/package-summary.html">controls</a> and <a href="https://static.javadoc.io/io.vavr/vavr/0.10.3/io/vavr/collection/package-summary.html">collections</a> to accomplish this goal in every-day Java programming.</p>
</div>
<div class="paragraph">
<p>Vavr は日々の Java プログラミングでより良い Java を記述するために必要な <a href="http://static.javadoc.io/io.vavr/vavr/0.10.3/io/vavr/control/package-summary.html">制御構造</a> と <a href="https://static.javadoc.io/io.vavr/vavr/0.10.3/io/vavr/collection/package-summary.html">コレクション</a> を提供します。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_データ構造入門">1.3. データ構造入門</h3>
<div class="paragraph">
<p>Vavr’s collection library comprises of a rich set of functional data structures built on top of lambdas. The only interface they share with Java’s original collections is Iterable. The main reason is that the mutator methods of Java’s collection interfaces do not return an object of the underlying collection type.</p>
</div>
<div class="paragraph">
<p>Vavr のコレクションライブラリは、ラムダ式を活用したさまざまな関数型のデータ構造を提供します。<br>
Java の標準コレクションの中でも、Iterable インターフェイスだけは共有しています。<br>
なぜなら、標準コレクションのインターフェイスに含まれる「状態や値を変更するメソッド（mutator method）」は、コレクションに格納しているデータ型のオブジェクトを返さないからです。</p>
</div>
<div class="paragraph">
<p>We will see why this is so essential by taking a look at the different types of data structures.</p>
</div>
<div class="paragraph">
<p>いろいろなデータ構造を見ながら、その理由について考えていきましょう。</p>
</div>
<div class="sect3">
<h4 id="_可変データ構造">1.3.1. 可変データ構造</h4>
<div class="paragraph">
<p>Java is an object-oriented programming language. We encapsulate state in objects to achieve data hiding and provide mutator methods to control the state. The <a href="https://en.wikipedia.org/wiki/Java_collections_framework">Java collections framework (JCF)</a> is built upon this idea.</p>
</div>
<div class="paragraph">
<p>Java はオブジェクト指向プログラミング言語です。<br>
データを隠蔽するために状態をオブジェクトにカプセル化し、状態を制御するために「状態や値を変更するメソッド（mutator method）」を提供します。<br>
これが、 <a href="https://en.wikipedia.org/wiki/Java_collections_framework">Java のコレクションフレームワーク</a>の元になっている考え方です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">interface</span> <span class="class">Collection</span>&lt;E&gt; {
    <span class="comment">// コレクションから全ての要素を削除する</span>
    <span class="type">void</span> clear();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Today I comprehend a <em>void</em> return type as a smell. It is evidence that <a href="https://en.wikipedia.org/wiki/Side_effect_(computer_science)">side-effects</a> take place, state is mutated. <em>Shared</em> mutable state is an important source of failure, not only in a concurrent setting.</p>
</div>
<div class="paragraph">
<p>今の私は返り値の型が <em>void</em> であることをコードの悪臭として認識するようになりました。<br>
<a href="https://en.wikipedia.org/wiki/Side_effect_(computer_science)">副作用</a> の存在がその証拠です。<br>
状態を変更してますよね。<br>
可変の状態を <em>共有する</em> のは、並行処理の有無に関わらず失敗の元でしかありません。</p>
</div>
</div>
<div class="sect3">
<h4 id="_不変データ構造">1.3.2. 不変データ構造</h4>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Immutable_object">Immutable</a> data structures cannot be modified after their creation. In the context of Java they are widely used in the form of collection wrappers.</p>
</div>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Immutable_object">不変</a>データ構造は、一度作成したら二度と変更できません。<br>
Java では、それぞれのコレクションに対応する不変コレクションがラッパーとして使われています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; list = <span class="predefined-type">Collections</span>.unmodifiableList(otherList);

<span class="comment">// バーン！</span>
list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">why not?</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are various libraries that provide us with similar utility methods. The result is always an unmodifiable view of the specific collection. Typically it will throw at runtime when we call a mutator method.</p>
</div>
<div class="paragraph">
<p>さまざまなライブラリが似たようなユーティリティメソッドを提供しています。<br>
どれも、元のコレクションに対応する変更不可能なビューを返すものです。<br>
たいていの場合、「状態や値を変更するメソッド（mutator method）」を呼び出すと実行時に例外を送出するようになっています。</p>
</div>
</div>
<div class="sect3">
<h4 id="_永続データ構造">1.3.3. 永続データ構造</h4>
<div class="paragraph">
<p>A <a href="https://en.wikipedia.org/wiki/Persistent_data_structure">persistent data structure</a> does preserve the previous version of itself when being modified and is therefore <em>effectively</em> immutable. Fully persistent data structures allow both updates and queries on any version.</p>
</div>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Persistent_data_structure">永続データ構造</a> は、変更する前の状態を記憶している、<em>実質的な</em> 不変性を備えているデータ構造です。<br>
完全な永続データ構造なら、状態を変更できるだけでなく、任意の時点の状態を参照できます。</p>
</div>
<div class="paragraph">
<p>Many operations perform only small changes. Just copying the previous version wouldn’t be efficient. To save time and memory, it is crucial to identify similarities between two versions and share as much data as possible.</p>
</div>
<div class="paragraph">
<p>大半の操作が行うのは小規模な変更だけです。<br>
ひとつ前の状態を複製するだけでは不十分です。<br>
時間とメモリを節約するには、ひとつ前と今の状態の共通点を特定し、できるだけ共通点を共有する必要があります。</p>
</div>
<div class="paragraph">
<p>This model does not impose any implementation details. Here come functional data structures into play.</p>
</div>
<div class="paragraph">
<p>このモデルは具体的な実装を強制するものではありません。<br>
次は関数型データ構造について説明します。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_関数型データ構造">1.4. 関数型データ構造</h3>
<div class="paragraph">
<p>Also known as <a href="https://en.wikipedia.org/wiki/Purely_functional"><em>purely</em> functional data structures</a>, these are <em>immutable</em> and <em>persistent</em>. The methods of functional data structures are <em>referentially transparent</em>.</p>
</div>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Purely_functional"><em>純粋</em> 関数型データ構造</a>と呼ばれているデータ構造で、<em>不変性</em> と <em>永続性</em> を備えています。<br>
関数型データ構造のメソッドは <em>参照透過</em> です。</p>
</div>
<div class="paragraph">
<p>Vavr features a wide range of the most-commonly used functional data structures. The following examples are explained in-depth.</p>
</div>
<div class="paragraph">
<p>Vavr は一般的に使用されているほとんどの関数型データ構造を提供しています。<br>
ここでは、具体例で説明していきます。</p>
</div>
<div class="sect3">
<h4 id="_連結リスト">1.4.1. 連結リスト</h4>
<div class="paragraph">
<p>One of the most popular and also simplest functional data structures is the <a href="https://en.wikipedia.org/wiki/Linked_list">(singly) linked List</a>. It has a <em>head</em> element and a <em>tail</em> List. A linked List behaves like a Stack which follows the <a href="https://en.wikipedia.org/wiki/Stack_(abstract_data_type)">last in, first out (LIFO)</a> method.</p>
</div>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Linked_list">（単一）連結リスト</a>は最も単純な関数型データ構造の1つです。<br>
<em>先頭（head）</em> 要素と <em>末尾（tail）</em> リストで構成されています。<br>
連結リストは、 <a href="https://en.wikipedia.org/wiki/Stack_(abstract_data_type)">後入れ先出し（LIFO: last in, first out）</a> のメソッドを持つスタックのように振る舞います。</p>
</div>
<div class="paragraph">
<p>In <a href="http://vavr.io/">Vavr</a> we instantiate a List like this:</p>
</div>
<div class="paragraph">
<p>Vavr では次のようにリストを生成できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// = List(1, 2, 3)</span>
<span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; list1 = <span class="predefined-type">List</span>.of(<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each of the List elements forms a separate List node. The tail of the last element is Nil, the empty List.</p>
</div>
<div class="paragraph">
<p>リストのそれぞれの要素は独立したリストのノードです。<br>
最後の要素の tail は Nil すなわち空リストです。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/list1.png?w=660" alt="List 1">
</div>
</div>
<div class="paragraph">
<p>This enables us to share elements across different versions of the List.</p>
</div>
<div class="paragraph">
<p>Vavr では同じ要素を複数のリストで共有できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// = List(0, 2, 3)</span>
<span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; list2 = list1.tail().prepend(<span class="integer">0</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The new head element 0 is <em>linked</em> to the tail of the original List. The original List remains unmodified.</p>
</div>
<div class="paragraph">
<p>新しい head 要素 0 は元のリストの tail に <em>連結</em> しています。<br>
元のリストはそのまま残っているのです。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/list2.png?w=660" alt="List 2">
</div>
</div>
<div class="paragraph">
<p>These operations take place in constant time, in other words they are independent of the List size. Most of the other operations take linear time. In Vavr this is expressed by the interface LinearSeq, which we may already know from Scala.</p>
</div>
<div class="paragraph">
<p>それぞれの操作には、リストの大きさとは関係なく一定の時間（定数時間）がかかります。<br>
他のほとんどの操作には線形時間がかかります。<br>
Vavr ではそのような操作を LinearSeq インターフェイスとして表現しています。<br>
ご存じの通り Scala からの借用です。</p>
</div>
<div class="paragraph">
<p>If we need data structures that are queryable in constant time, Vavr offers Array and Vector. Both have <a href="https://en.wikipedia.org/wiki/Random_access">random access</a> capabilities.</p>
</div>
<div class="paragraph">
<p>Vavr において、定数時間でアクセスできるデータ構造が必要なときは、Array か Vector を使います。<br>
どちらも <a href="https://en.wikipedia.org/wiki/Random_access">ランダムアクセス</a> 機能を備えているからです。</p>
</div>
<div class="paragraph">
<p>The Array type is backed by a Java array of objects. Insert and remove operations take linear time. Vector is in-between Array and List. It performs well in both areas, random access and modification.</p>
</div>
<div class="paragraph">
<p>Array 型の実装は Java の配列です。<br>
追加と削除には線形時間がかかります。<br>
Vector は Array と List の中間です。<br>
ランダムアクセスと変更操作のどちらについても、そこそこの性能を示します。</p>
</div>
<div class="paragraph">
<p>In fact the linked List can also be used to implement a Queue data structure.</p>
</div>
<div class="paragraph">
<p>そういえば、連結リストを使うとキューを実装できます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_キュー">1.4.2. キュー</h4>
<div class="paragraph">
<p>A very efficient functional Queue can be implemented based on two linked Lists. The <em>front</em> List holds the elements that are <em>dequeued</em>, the <em>rear</em> List holds the elements that are <em>enqueued</em>. Both operations enqueue and dequeue perform in O(1).</p>
</div>
<div class="paragraph">
<p>2つの連結リストを使うと、非常に効率のよい関数型のキューを実装できます。<br>
<em>前方（front）</em> リストは <em>キューから取り出された（dequeue）</em> 要素を保持します。<br>
<em>後方（rear）</em> リストは <em>キューに追加された（enqueue）</em> 要素を保持します。<br>
enqueue と dequeue のどちらの操作も実行時間は O(1) です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Queue</span>&lt;<span class="predefined-type">Integer</span>&gt; queue = <span class="predefined-type">Queue</span>.of(<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>)
                            .enqueue(<span class="integer">4</span>)
                            .enqueue(<span class="integer">5</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The initial Queue is created of three elements. Two elements are enqueued on the rear List.</p>
</div>
<div class="paragraph">
<p>このコードでは、3要素のキューを作成し、rear に2つの要素を enqueue しています。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/queue1.png?w=660" alt="Queue 1">
</div>
</div>
<div class="paragraph">
<p>If the front List runs out of elements when dequeueing, the rear List is reversed and becomes the new front List.</p>
</div>
<div class="paragraph">
<p>dequeue するときに front が一杯になってしまったら、rear を逆順にして新たに front として使用します。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/queue2.png?w=660" alt="Queue 2">
</div>
</div>
<div class="paragraph">
<p>When dequeueing an element we get a pair of the first element and the remaining Queue. It is necessary to return the new version of the Queue because functional data structures are immutable and persistent. The original Queue is not affected.</p>
</div>
<div class="paragraph">
<p>キューから dequeue すると、先頭要素と後続キューの対が得られます。<br>
関数型データ構造は不変性と永続性を備えているので、新たなキューを返さなければならないからです。<br>
元のキューには影響しません。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Queue</span>&lt;<span class="predefined-type">Integer</span>&gt; queue = <span class="predefined-type">Queue</span>.of(<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>);

<span class="comment">// = (1, Queue(2, 3))</span>
Tuple2&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Queue</span>&lt;<span class="predefined-type">Integer</span>&gt;&gt; dequeued =
        queue.dequeue();</code></pre>
</div>
</div>
<div class="paragraph">
<p>What happens when the Queue is empty? Then dequeue() will throw a NoSuchElementException. To do it the <em>functional way</em> we would rather expect an optional result.</p>
</div>
<div class="paragraph">
<p>空のキューに操作するとどうなるでしょうか。<br>
dequeue は NoSucheElementException をスローするでしょう。<br>
<em>関数型プログラミングのやり方</em> ではオプショナルを返すことが期待されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// = Some((1, Queue()))</span>
<span class="predefined-type">Queue</span>.of(<span class="integer">1</span>).dequeueOption();

<span class="comment">// = None</span>
<span class="predefined-type">Queue</span>.empty().dequeueOption();</code></pre>
</div>
</div>
<div class="paragraph">
<p>An optional result may be further processed, regardless if it is empty or not.</p>
</div>
<div class="paragraph">
<p>返り値のオプショナルは空であろうとなかろうと、そのまま処理を継続できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// = Queue(1)</span>
<span class="predefined-type">Queue</span>&lt;<span class="predefined-type">Integer</span>&gt; queue = <span class="predefined-type">Queue</span>.of(<span class="integer">1</span>);

<span class="comment">// = Some((1, Queue()))</span>
<span class="predefined-type">Option</span>&lt;Tuple2&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Queue</span>&lt;<span class="predefined-type">Integer</span>&gt;&gt;&gt; dequeued =
        queue.dequeueOption();

<span class="comment">// = Some(1)</span>
<span class="predefined-type">Option</span>&lt;<span class="predefined-type">Integer</span>&gt; element = dequeued.map(Tuple2::_1);

<span class="comment">// = Some(Queue())</span>
<span class="predefined-type">Option</span>&lt;<span class="predefined-type">Queue</span>&lt;<span class="predefined-type">Integer</span>&gt;&gt; remaining =
        dequeued.map(Tuple2::_2);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_順序付きセット">1.4.3. 順序付きセット</h4>
<div class="paragraph">
<p>Sorted Sets are data structures that are more frequently used than Queues. We use binary search trees to model them in a functional way. These trees consist of nodes with up to two children and values at each node.</p>
</div>
<div class="paragraph">
<p>順序付きセットはキューよりよく使われるデータ構造で、関数型データ構造としては2分探索木で実装できます。<br>
2分探索木は最大2つの子ノードと1つの値を持つノードで構成されています。</p>
</div>
<div class="paragraph">
<p>We build binary search trees in the presence of an ordering, represented by an element Comparator. All values of the left subtree of any given node are strictly less than the value of the given node. All values of the right subtree are strictly greater.</p>
</div>
<div class="paragraph">
<p>Vavr ではそれぞれの要素に対応する Comparator に基づく順序付けにより、2分探索木を構築しています。<br>
あらゆるノードの左部分木の値はそのノードの値より必ず小さくなりますし、右部分木の値はそのノードの値より必ず大きくなります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// = TreeSet(1, 2, 3, 4, 6, 7, 8)</span>
<span class="predefined-type">SortedSet</span>&lt;<span class="predefined-type">Integer</span>&gt; xs = <span class="predefined-type">TreeSet</span>.of(<span class="integer">6</span>, <span class="integer">1</span>, <span class="integer">3</span>, <span class="integer">2</span>, <span class="integer">4</span>, <span class="integer">7</span>, <span class="integer">8</span>);</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/binarytree1.png?w=660" alt="Binary Tree 1">
</div>
</div>
<div class="paragraph">
<p>Searches on such trees run in O(log n) time. We start the search at the root and decide if we found the element. Because of the total ordering of the values we know where to search next, in the left or in the right branch of the current tree.</p>
</div>
<div class="paragraph">
<p>木の探索にかかる時間は O(log n) です。<br>
探索は根から開始して、目的の要素が見つかるまで続けます。<br>
全ての値は順序付けられているので、今のノードから左と右のどちらの部分木を探索するか判断できるのです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// = TreeSet(1, 2, 3);</span>
<span class="predefined-type">SortedSet</span>&lt;<span class="predefined-type">Integer</span>&gt; set = <span class="predefined-type">TreeSet</span>.of(<span class="integer">2</span>, <span class="integer">3</span>, <span class="integer">1</span>, <span class="integer">2</span>);

<span class="comment">// = TreeSet(3, 2, 1);</span>
<span class="predefined-type">Comparator</span>&lt;<span class="predefined-type">Integer</span>&gt; c = (a, b) -&gt; b - a;
<span class="predefined-type">SortedSet</span>&lt;<span class="predefined-type">Integer</span>&gt; reversed = <span class="predefined-type">TreeSet</span>.of(c, <span class="integer">2</span>, <span class="integer">3</span>, <span class="integer">1</span>, <span class="integer">2</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Most tree operations are inherently <a href="https://en.wikipedia.org/wiki/Recursion">recursive</a>. The insert function behaves similarly to the search function. When the end of a search path is reached, a new node is created and the whole path is reconstructed up to the root. Existing child nodes are referenced whenever possible. Hence the insert operation takes O(log n) time and space.</p>
</div>
<div class="paragraph">
<p>木に関するほとんどの操作は本質的に <a href="https://en.wikipedia.org/wiki/Recursion">再帰的</a>になります。<br>
挿入は探索と同じように行います。<br>
探索位置が終端に到達したら新しいノードを作成し、根に向かって木を再構築します。<br>
できるだけ既存のノードを再利用するようにします。<br>
挿入は時間と空間のどちらにも O(log n) のコストがかかります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// = TreeSet(1, 2, 3, 4, 5, 6, 7, 8)</span>
<span class="predefined-type">SortedSet</span>&lt;<span class="predefined-type">Integer</span>&gt; ys = xs.add(<span class="integer">5</span>);</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/binarytree2.png?w=660" alt="Binary Tree 2">
</div>
</div>
<div class="paragraph">
<p>In order to maintain the performance characteristics of a binary search tree it needs to be kept balanced. All paths from the root to a leaf need to have roughly the same length.</p>
</div>
<div class="paragraph">
<p>2分木の性能特性を保証するには、定期的な木の再編成が必要です。<br>
根から全ての葉に対する距離が、ほぼ等しくなるようにしなければなりません。</p>
</div>
<div class="paragraph">
<p>In Vavr we implemented a binary search tree based on a <a href="https://en.wikipedia.org/wiki/Red%E2%80%93black_tree">Red/Black Tree</a>. It uses a specific coloring strategy to keep the tree balanced on inserts and deletes. To read more about this topic please refer to the book <a href="http://www.amazon.com/Purely-Functional-Structures-Chris-Okasaki/dp/0521663504">Purely Functional Data Structures</a> by Chris Okasaki.</p>
</div>
<div class="paragraph">
<p>Vavr では2分木を <a href="https://en.wikipedia.org/wiki/Red%E2%80%93black_tree">赤黒木</a>に基づいて実装しています。<br>
木へ挿入したり、削除したりするとき、特定の色戦略で木が均等になるようにします。<br>
詳細なアルゴリズムに興味があるなら、Chris Okasaki の著書 <a href="http://www.amazon.com/Purely-Functional-Structures-Chris-Okasaki/dp/0521663504">Purely Functional Data Structures</a> を参照してください。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_最先端のコレクション">1.5. 最先端のコレクション</h3>
<div class="paragraph">
<p>Generally we are observing a convergence of programming languages. Good features make it, other disappear. But Java is different, it is bound forever to be backward compatible. That is a strength but also slows down evolution.</p>
</div>
<div class="paragraph">
<p>普通のプログラミング言語は、良いところを残してそれ以外を捨てていくものだと考えています。<br>
しかし Java はそうしませんでした。<br>
後方互換性を保証することにしたのです。<br>
プログラミング言語としての信頼性は高まりましたが、進化の速度を遅くさせてしまう決定でした。</p>
</div>
<div class="paragraph">
<p>Lambda brought Java and Scala closer together, yet they are still so different. Martin Odersky, the creator of Scala, recently mentioned in his <a href="https://www.youtube.com/watch?v=NW5h8d_ZyOs">BDSBTB 2015 keynote</a> the state of the Java 8 collections.</p>
</div>
<div class="paragraph">
<p>ラムダ式により Java は Scala と遜色ない言語になりましたが、それでも大きく異なる部分は残っています。<br>
Scala 言語の作者である Martin Odersky は、 <a href="https://www.youtube.com/watch?v=NW5h8d_ZyOs">BDSBTB 2015 keynote</a> で Java 8 の標準コレクションの先進性について言及しています。</p>
</div>
<div class="paragraph">
<p>He described Java’s Stream as a fancy form of an Iterator. The Java 8 Stream API is an example of a <em>lifted</em> collection. What it does is to <em>define</em> a computation and <em>link</em> it to a specific collection in another explicit step.</p>
</div>
<div class="paragraph">
<p>Martin Odersky は Java の Stream をとても手の込んだ Iterator だと述べています。<br>
Java 8 で導入された Stream API は、コレクションを <em>新しい水準へ引き上げる</em> 恰好の例だというのです。<br>
すなわち、計算という概念を <em>定義し</em> 、任意のコレクションを何らかの処理手続きと <em>結びつける</em> のです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// i + 1</span>
i.prepareForAddition()
 .add(<span class="integer">1</span>)
 .mapBackToInteger(Mappers.toInteger())</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is how the new Java 8 Stream API works. It is a computational layer above the well known Java collections.</p>
</div>
<div class="paragraph">
<p>Java 8 の Stream API は、既存のコレクションへ計算レイヤーを追加するものだったのです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// = [&quot;1&quot;, &quot;2&quot;, &quot;3&quot;] in Java 8</span>
<span class="predefined-type">Arrays</span>.asList(<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>)
      .stream()
      .map(<span class="predefined-type">Object</span>::toString)
      .collect(Collectors.toList())</code></pre>
</div>
</div>
<div class="paragraph">
<p>Vavr is greatly inspired by Scala. This is how the above example should have been in Java 8.</p>
</div>
<div class="paragraph">
<p>Vavr の設計は Scala 言語から多くの発想を得ています。<br>
ですので、Vavr では前のコード例を次のように記述できるようにします。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// = Stream(&quot;1&quot;, &quot;2&quot;, &quot;3&quot;) in Vavr</span>
Stream.of(<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>).map(<span class="predefined-type">Object</span>::toString)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Within the last year we put much effort into implementing the Vavr collection library. It comprises the most widely used collection types.</p>
</div>
<div class="paragraph">
<p>昨年はかなりの時間を Vavr のコレクションライブラリの実装に費やしました。<br>
主に、最も広く使われているコレクション型 Seq が対象です。</p>
</div>
<div class="sect3">
<h4 id="_並び">1.5.1. 並び</h4>
<div class="paragraph">
<p>We started our journey by implementing sequential types. We already described the linked List above. Stream, a lazy linked List, followed. It allows us to process possibly infinite long sequences of elements.</p>
</div>
<div class="paragraph">
<p>最初はシーケンシャル型を実装することにしました。<br>
連結リスト、Stream、遅延連結リストが出来ているので、無限シーケンスを作成できます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/collections-seq.png?w=660" alt="Seq">
</div>
</div>
<div class="paragraph">
<p>All collections are Iterable and hence could be used in enhanced for-statements.</p>
</div>
<div class="paragraph">
<p>Vavr の全てのコレクションは Iterable を実装しているので、拡張 for 文で使用できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">for</span> (<span class="predefined-type">String</span> s : <span class="predefined-type">List</span>.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">Java</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Advent</span><span class="delimiter">&quot;</span></span>)) {
    <span class="comment">// side effects and mutation</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We could accomplish the same by internalizing the loop and injecting the behavior using a lambda.</p>
</div>
<div class="paragraph">
<p>内部イテレータとラムダ式で同じ処理を記述できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">Java</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Advent</span><span class="delimiter">&quot;</span></span>).forEach(s -&gt; {
    <span class="comment">// side effects and mutation</span>
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Anyway, as we previously saw we prefer expressions that return a value over statements that return nothing. By looking at a simple example, soon we will recognize that statements add noise and divide what belongs together.</p>
</div>
<div class="paragraph">
<p>いずれにしても、私たちは値を返す式のほうが適切であるという考えを説明してきました。<br>
次のようなコード例を見れば、文が邪魔して理解を妨げているのが分かるでしょう。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> join(<span class="predefined-type">String</span>... words) {
    <span class="predefined-type">StringBuilder</span> builder = <span class="keyword">new</span> <span class="predefined-type">StringBuilder</span>();
    <span class="keyword">for</span>(<span class="predefined-type">String</span> s : words) {
        <span class="keyword">if</span> (builder.length() &gt; <span class="integer">0</span>) {
            builder.append(<span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span>);
        }
        builder.append(s);
    }
    <span class="keyword">return</span> builder.toString();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Vavr collections provide us with many functions to operate on the underlying elements. This allows us to express things in a very concise way.</p>
</div>
<div class="paragraph">
<p>Vavr のコレクションは、それぞれの要素に何らかの処理を適用するためのさまざまな関数を提供しています。<br>
つまり、次のように簡潔に記述できるということです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> join(<span class="predefined-type">String</span>... words) {
    <span class="keyword">return</span> <span class="predefined-type">List</span>.of(words)
               .intersperse(<span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span>)
               .foldLeft(<span class="keyword">new</span> <span class="predefined-type">StringBuilder</span>(), <span class="predefined-type">StringBuilder</span>::append)
               .toString();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Most goals can be accomplished in various ways using Vavr. Here we reduced the whole method body to fluent function calls on a List instance. We could even remove the whole method and directly use our List to obtain the computation result.</p>
</div>
<div class="paragraph">
<p>Vavr はたいていの問題を記述するための方法を提供します。<br>
メソッド全体を List オブジェクトに対する fluent な関数の呼び出しで実装できます。<br>
メソッド自体を無くして List から直接敵に計算結果を取得することもできるのです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>.of(words).mkString(<span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In a real world application we are now able to drastically reduce the number of lines of code and hence lower the risk of bugs.</p>
</div>
<div class="paragraph">
<p>実際のアプリケーション実装に必要とされる何行ものコードを節約できるので、バグの混入リスクも低下します。</p>
</div>
</div>
<div class="sect3">
<h4 id="_セット_set_とマップ_map">1.5.2. セット（Set）とマップ（Map）</h4>
<div class="paragraph">
<p>Sequences are great. But to be complete, a collection library also needs different types of Sets and Maps.</p>
</div>
<div class="paragraph">
<p>シーケンスは有能ですが何でも解決できるわけではありません。<br>
コレクションライブラリにはセット（Set）とマップ（Map）が必要です。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/collections-set-map.png?w=660" alt="Set and Map">
</div>
</div>
<div class="paragraph">
<p>We described how to model sorted Sets with binary tree structures. A sorted Map is nothing else than a sorted Set containing key-value pairs and having an ordering for the keys.</p>
</div>
<div class="paragraph">
<p>ここまでに、二分木に基づく順序付きセットについて説明しました。<br>
順序付きマップとは、キーと値の対を要素とし、キーの順番に整列された順序付きセットそのものです。</p>
</div>
<div class="paragraph">
<p>The HashMap implementation is backed by a <a href="http://lampwww.epfl.ch/papers/idealhashtrees.pdf">Hash Array Mapped Trie (HAMT)</a>. Accordingly the HashSet is backed by a HAMT containing key-key pairs.</p>
</div>
<div class="paragraph">
<p>HashMap は <a href="http://lampwww.epfl.ch/papers/idealhashtrees.pdf">Hash Array Mapped Trie (HAMT)</a> に基づいて実装されています。<br>
同様に、HashSet もキーと値の対を要素とする HAMT で実装されています。</p>
</div>
<div class="paragraph">
<p>Our Map does <em>not</em> have a special Entry type to represent key-value pairs. Instead we use Tuple2 which is already part of Vavr. The fields of a Tuple are enumerated.</p>
</div>
<div class="paragraph">
<p>Vavr の提供するマップには、キーと値の対を表現する特別な型が <em>ありません</em> 。<br>
Tuple2 という型を代用します。<br>
Tuple のフィールドは列挙可能です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// = (1, &quot;A&quot;)</span>
Tuple2&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt; entry = Tuple.of(<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">A</span><span class="delimiter">&quot;</span></span>);

<span class="predefined-type">Integer</span> key = entry._1;
<span class="predefined-type">String</span> value = entry._2;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Maps and Tuples are used throughout Vavr. Tuples are inevitable to handle multi-valued return types in a general way.</p>
</div>
<div class="paragraph">
<p>Vavr ではあらゆる場面でマップとタプル（Tuple）を使用します。<br>
多値を返り値にするにはタプルを使うのが一般的な方法です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// = HashMap((0, List(2, 4)), (1, List(1, 3)))</span>
<span class="predefined-type">List</span>.of(<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>, <span class="integer">4</span>).groupBy(i -&gt; i % <span class="integer">2</span>);

<span class="comment">// = List((a, 0), (b, 1), (c, 2))</span>
<span class="predefined-type">List</span>.of(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).zipWithIndex();</code></pre>
</div>
</div>
<div class="paragraph">
<p>At Vavr, we explore and test our library by implementing the <a href="https://projecteuler.net/archives">99 Euler Problems</a>. It is a great proof of concept. Please don’t hesitate to send pull requests.</p>
</div>
<div class="paragraph">
<p>Vavr ではライブラリの検査やテストのために <a href="https://projecteuler.net/archives">99 Euler Problems</a> を実装しています。<br>
概念実証として比肩するものはないでしょう。<br>
恐れることなく、変更の提案（プルリクエスト）を作成してください。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_vavr_入門">2. Vavr 入門</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Projects that include Vavr need to target Java 1.8 at minimum.</p>
</div>
<div class="paragraph">
<p>Vavr を使用するプロジェクトのコンパイルバージョンは、最低でも Java 1.8 にしなければなりません。</p>
</div>
<div class="paragraph">
<p>The .jar is available at <a href="http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22io.vavr%22%20a%3A%22vavr%22">Maven Central</a>.</p>
</div>
<div class="paragraph">
<p>Vavr の jar ファイルは <a href="http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22io.vavr%22%20a%3A%22vavr%22">Maven Central</a> で公開されています。</p>
</div>
<div class="sect2">
<h3 id="_gradle">2.1. Gradle</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    compile "io.vavr:vavr:0.10.3"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_maven">2.2. Maven</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>io.vavr<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>vavr<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>0.10.3<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_スタンドアローン">2.3. スタンドアローン</h3>
<div class="paragraph">
<p>Because Vavr does <em>not</em> depend on any libraries (other than the JVM) you can easily add it as standalone .jar to your classpath.</p>
</div>
<div class="paragraph">
<p>Vavr の依存ライブラリは Java の標準ライブラリだけなので、jar ファイルをクラスパスに追加するだけで使い始められるようになっています。</p>
</div>
</div>
<div class="sect2">
<h3 id="_スナップショット">2.4. スナップショット</h3>
<div class="paragraph">
<p>Developer versions can be found <a href="https://oss.sonatype.org/content/repositories/snapshots/io/vavr/vavr">here</a>.</p>
</div>
<div class="paragraph">
<p>開発中のバージョンは <a href="https://oss.sonatype.org/content/repositories/snapshots/io/vavr/vavr">SonartypeのMavenリポジトリ</a> で公開されています。</p>
</div>
<div class="sect3">
<h4 id="_gradle_2">2.4.1. Gradle</h4>
<div class="paragraph">
<p>Add the additional snapshot repository to your <code>build.gradle</code>:</p>
</div>
<div class="paragraph">
<p>プロジェクトの <code>build.gradle</code> へスナップショットリポジトリを追加してください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    (...)
    maven { url <span class="string"><span class="delimiter">&quot;</span><span class="content">https://oss.sonatype.org/content/repositories/snapshots</span><span class="delimiter">&quot;</span></span> }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_maven_2">2.4.2. Maven</h4>
<div class="paragraph">
<p>Ensure that your <code>~/.m2/settings.xml</code> contains the following:</p>
</div>
<div class="paragraph">
<p><code>~/.m2/settings.xml</code> へスナップショットリポジトリを追加してください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;profiles&gt;</span>
    <span class="tag">&lt;profile&gt;</span>
        <span class="tag">&lt;id&gt;</span>allow-snapshots<span class="tag">&lt;/id&gt;</span>
        <span class="tag">&lt;activation&gt;</span>
            <span class="tag">&lt;activeByDefault&gt;</span>true<span class="tag">&lt;/activeByDefault&gt;</span>
        <span class="tag">&lt;/activation&gt;</span>
        <span class="tag">&lt;repositories&gt;</span>
            <span class="tag">&lt;repository&gt;</span>
                <span class="tag">&lt;id&gt;</span>snapshots-repo<span class="tag">&lt;/id&gt;</span>
                <span class="tag">&lt;url&gt;</span>https://oss.sonatype.org/content/repositories/snapshots<span class="tag">&lt;/url&gt;</span>
                <span class="tag">&lt;releases&gt;</span>
                    <span class="tag">&lt;enabled&gt;</span>false<span class="tag">&lt;/enabled&gt;</span>
                <span class="tag">&lt;/releases&gt;</span>
                <span class="tag">&lt;snapshots&gt;</span>
                    <span class="tag">&lt;enabled&gt;</span>true<span class="tag">&lt;/enabled&gt;</span>
                <span class="tag">&lt;/snapshots&gt;</span>
            <span class="tag">&lt;/repository&gt;</span>
        <span class="tag">&lt;/repositories&gt;</span>
    <span class="tag">&lt;/profile&gt;</span>
<span class="tag">&lt;/profiles&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_利用ガイド">3. 利用ガイド</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vavr comes along with well-designed representations of some of the most basic types which apparently are missing or rudimentary in Java: <code>Tuple</code>, <code>Value</code> and <code>λ</code>.<br>
In Vavr, everything is built upon these three basic building blocks:</p>
</div>
<div class="paragraph">
<p>Vavr は、これまでの Java に不足していた基本的な型の <code>Tuple</code> および <code>Value</code> そして <code>λ</code> に関する適切な表現に基づいています。<br>
あらゆる要素がこれらの基本的な構成要素で成り立っているといっても過言ではありません。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/vavr-overview.png" alt="Vavr Overview">
</div>
</div>
<div class="sect2">
<h3 id="_タプル">3.1. タプル</h3>
<div class="paragraph">
<p>Java is missing a general notion of tuples. A Tuple combines a fixed number of elements together so that they can be passed around as a whole. Unlike an array or list, a tuple can hold objects with different types, but they are also immutable.<br>
Tuples are of type Tuple1, Tuple2, Tuple3 and so on. There currently is an upper limit of 8 elements. To access elements of a tuple <code>t</code>, you can use method <code>t._1</code> to access the first element, <code>t._2</code> to access the second, and so on.</p>
</div>
<div class="paragraph">
<p>Java にはタプルを記述する方法がありません。<br>
タプルとは、有限数の要素を束ねて1つの要素として扱えるようにするものです。<br>
配列やリストと違って異なる型のオブジェクトを持つことができますが、それぞれの要素は不変でなければなりません。<br>
Vavr は <code>Tuple1</code> や <code>Tuple2</code> や <code>Tuple3</code> など要素数に対応する型を提供します。<br>
今のところ <code>Tuple8</code> が最大です。<br>
タプル <code>t</code> について、<code>t._1</code> で先頭の要素へ、<code>t._2</code> で2番目の要素へアクセスできます。</p>
</div>
<div class="sect3">
<h4 id="_タプルの作成">3.1.1. タプルの作成</h4>
<div class="paragraph">
<p>Here is an example of how to create a tuple holding a String and an Integer:</p>
</div>
<div class="paragraph">
<p>String と Integer を持つタプルは次のように作成します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// (Java, 8)</span>
Tuple2&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; java8 = Tuple.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">Java</span><span class="delimiter">&quot;</span></span>, <span class="integer">8</span>); <i class="conum" data-value="1"></i><b>(1)</b>

<span class="comment">// &quot;Java&quot;</span>
<span class="predefined-type">String</span> s = java8._1; <i class="conum" data-value="2"></i><b>(2)</b>

<span class="comment">// 8</span>
<span class="predefined-type">Integer</span> i = java8._2; <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>静的ファクトリメソッド <code>Tuple.of()</code> でタプルを作成します</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>先頭要素にアクセスします</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>2番目の要素にアクセスします</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_タプルの要素ごとにマップする">3.1.2. タプルの要素ごとにマップする</h4>
<div class="paragraph">
<p>The component-wise map evaluates a function per element in the tuple, returning another tuple.</p>
</div>
<div class="paragraph">
<p>タプルの要素ごとに関数を評価して、新しいタプルを返すことができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// (vavr, 1)</span>
Tuple2&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; that = java8.map(
        s -&gt; s.substring(<span class="integer">2</span>) + <span class="string"><span class="delimiter">&quot;</span><span class="content">vr</span><span class="delimiter">&quot;</span></span>,
        i -&gt; i / <span class="integer">8</span>
);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_タプル全体をマップする">3.1.3. タプル全体をマップする</h4>
<div class="paragraph">
<p>It is also possible to map a tuple using one mapping function.</p>
</div>
<div class="paragraph">
<p>タプル全体を対象に関数を評価できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// (vavr, 1)</span>
Tuple2&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; that = java8.map(
        (s, i) -&gt; Tuple.of(s.substring(<span class="integer">2</span>) + <span class="string"><span class="delimiter">&quot;</span><span class="content">vr</span><span class="delimiter">&quot;</span></span>, i / <span class="integer">8</span>)
);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_タプルを変換する">3.1.4. タプルを変換する</h4>
<div class="paragraph">
<p>Transform creates a new type based on the tuple&#8217;s contents.</p>
</div>
<div class="paragraph">
<p>Transform はタプルの内容に基づく新しいオブジェクトを生成します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// &quot;vavr 1&quot;</span>
<span class="predefined-type">String</span> that = java8.apply(
        (s, i) -&gt; s.substring(<span class="integer">2</span>) + <span class="string"><span class="delimiter">&quot;</span><span class="content">vr </span><span class="delimiter">&quot;</span></span> + i / <span class="integer">8</span>
);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_関数">3.2. 関数</h3>
<div class="paragraph">
<p>Functional programming is all about values and transformation of values using functions. Java 8 just provides a <code>Function</code> which accepts one parameter and a <code>BiFunction</code> which accepts two parameters. Vavr provides functions up to a limit of 8 parameters. The functional interfaces are of called <code>Function0, Function1, Function2, Function3</code> and so on. If you need a function which throws a checked exception you can use <code>CheckedFunction1, CheckedFunction2</code> and so on.<br>
The following lambda expression creates a function to sum two integers:</p>
</div>
<div class="paragraph">
<p>関数型プログラミングでは、値と、関数による値の変換で全てを表現します。<br>
Java 8 では、1つの引数を受け取る <code>Function</code> や、2つの引数を受け取る <code>BiFunction</code> が導入されました。<br>
Vavr では最大8つの引数に対応した関数型インターフェイスの <code>Function0</code> や <code>Function1</code> （以下省略）を提供します。<br>
関数がチェック例外を送出しなければならないときのために <code>CheckedFunction1</code> や <code>CheckedFunction2</code> （以下省略）を提供します。<br>
次のコード例は、2つの整数を加算する関数を生成するラムダ式です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sum.apply(1, 2) = 3</span>
Function2&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; sum = (a, b) -&gt; a + b;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a shorthand for the following anonymous class definition:</p>
</div>
<div class="paragraph">
<p>これは、次のような匿名クラスの定義の短縮形にすぎません。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Function2&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; sum = <span class="keyword">new</span> Function2&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt;() {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Integer</span> apply(<span class="predefined-type">Integer</span> a, <span class="predefined-type">Integer</span> b) {
        <span class="keyword">return</span> a + b;
    }
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the static factory method <code>Function3.of(&#8230;&#8203;)</code> to a create a function from any method reference.</p>
</div>
<div class="paragraph">
<p>静的ファクトリメソッドの <code>Function3.of(&#8230;&#8203;)</code> を使うと、任意のメソッド参照から関数を作成できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Function3&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>, <span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; function3 =
        Function3.of(<span class="local-variable">this</span>::methodWhichAccepts3Parameters);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In fact Vavr functional interfaces are Java 8 functional interfaces on steroids. They also provide features like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Composition</p>
</li>
<li>
<p>Lifting</p>
</li>
<li>
<p>Currying</p>
</li>
<li>
<p>Memoization</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Vavr の関数型インターフェイスは Java 8 の関数型インターフェイスを強化します。<br>
具体的には次のような機能を拡張します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>合成</p>
</li>
<li>
<p>引き上げ</p>
</li>
<li>
<p>カリー化</p>
</li>
<li>
<p>メモ化</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_合成">3.2.1. 合成</h4>
<div class="paragraph">
<p>You can compose functions. In mathematics, function composition is the application of one function to the result of another to produce a third function. For instance, the functions f→: X → Y and g→: Y → Z can be composed to yield a function <code>h: g(f(x))</code> which maps X &#8594; Z.<br>
You can use either <code>andThen</code>:</p>
</div>
<div class="paragraph">
<p>関数は合成できます。<br>
数学的には、ある関数の結果を他の関数に適用する関数を生成するのが関数合成です。<br>
例えば、関数 <code>f→:X→Y</code> と関数 <code>g→:Y→Z</code> を合成した関数は <code>h: g(f(x))</code> となり、この関数は <code>X' を `Z</code> へ写像することになります。<br>
<code>andThen</code> メソッドで同じことができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Function1&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; plusOne = a -&gt; a + <span class="integer">1</span>;
Function1&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; multiplyByTwo = a -&gt; a * <span class="integer">2</span>;

Function1&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; add1AndMultiplyBy2 = plusOne.andThen(multiplyByTwo);

then(add1AndMultiplyBy2.apply(<span class="integer">2</span>)).isEqualTo(<span class="integer">6</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>or <code>compose</code>:</p>
</div>
<div class="paragraph">
<p>あるいは <code>compose</code> でも同様です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Function1&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; add1AndMultiplyBy2 = multiplyByTwo.compose(plusOne);

then(add1AndMultiplyBy2.apply(<span class="integer">2</span>)).isEqualTo(<span class="integer">6</span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_引き上げ">3.2.2. 引き上げ</h4>
<div class="paragraph">
<p>You can lift a partial function into a total function that returns an <code>Option</code> result. The term <em>partial function</em> comes from mathematics. A partial function from X to Y is a function f: X′ → Y, for some subset X′ of X. It generalizes the concept of a function f: X → Y by not forcing f to map every element of X to an element of Y. That means a partial function works properly only for some input values. If the function is called with a disallowed input value, it will typically throw an exception.</p>
</div>
<div class="paragraph">
<p>不完全関数を、<code>Option</code> を返す完全関数へ引き上げることができます。<br>
<em>不完全関数</em> という単語は数学からの借用です。<br>
X を Y に写像する不完全関数とは、X の部分集合 X` を写像する関数 <code>f:X`→Y</code> のことです。<br>
これは、関数 <code>f:X→Y</code> が、Xの全ての要素をYに写像できない場合も含むよう一般化する考え方です。<br>
つまり、不完全関数は一部の入力に対してのみ正常に機能することになります。<br>
たいていの場合、不適切な値で呼び出された不完全関数は例外を送出します。</p>
</div>
<div class="paragraph">
<p>The following method <code>divide</code> is a partial function that only accepts non-zero divisors.</p>
</div>
<div class="paragraph">
<p>次のコード例の <code>divide</code> メソッドは、0以外の値だけを許容する不完全関数です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Function2&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; divide = (a, b) -&gt; a / b;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We use <code>lift</code> to turn <code>divide</code> into a total function that is defined for all inputs.</p>
</div>
<div class="paragraph">
<p><code>divide</code> メソッドを <code>lift</code> すると、全ての入力を許容する完全関数へ引き上げられます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Function2&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>, <span class="predefined-type">Option</span>&lt;<span class="predefined-type">Integer</span>&gt;&gt; safeDivide = Function2.lift(divide);

<span class="comment">// = None</span>
<span class="predefined-type">Option</span>&lt;<span class="predefined-type">Integer</span>&gt; i1 = safeDivide.apply(<span class="integer">1</span>, <span class="integer">0</span>); <i class="conum" data-value="1"></i><b>(1)</b>

<span class="comment">// = Some(2)</span>
<span class="predefined-type">Option</span>&lt;<span class="predefined-type">Integer</span>&gt; i2 = safeDivide.apply(<span class="integer">4</span>, <span class="integer">2</span>); <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>引き上げた関数は、許容しない値を渡すと例外を送出する代わりに <code>None</code> を返します。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>引き上げた関数は、許容する値を渡すと <code>Some</code> を返します。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following method <code>sum</code> is a partial function that only accepts positive input values.</p>
</div>
<div class="paragraph">
<p>次のコード例の <code>sum</code> メソッドは、正の値だけを許容する不完全関数です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">int</span> sum(<span class="type">int</span> first, <span class="type">int</span> second) {
    <span class="keyword">if</span> (first &lt; <span class="integer">0</span> || second &lt; <span class="integer">0</span>) {
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Only positive integers are allowed</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="1"></i><b>(1)</b>
    }
    <span class="keyword">return</span> first + second;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>負の値を渡すと <code>sum</code> は <code>IllegalArgumentException</code> を送出します。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We may lift the <code>sum</code> method by providing the methods reference.</p>
</div>
<div class="paragraph">
<p><code>sum</code> メソッドを <code>lift</code> するには、メソッド参照を渡すこともできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Function2&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>, <span class="predefined-type">Option</span>&lt;<span class="predefined-type">Integer</span>&gt;&gt; sum = Function2.lift(<span class="local-variable">this</span>::sum);

<span class="comment">// = None</span>
<span class="predefined-type">Option</span>&lt;<span class="predefined-type">Integer</span>&gt; optionalResult = sum.apply(-<span class="integer">1</span>, <span class="integer">2</span>); <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>引き上げた関数は <code>IllegalArgumentException</code> を検出して <code>None</code> へ変換します。</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_部分適用">3.2.3. 部分適用</h4>
<div class="paragraph">
<p>Partial application allows you to derive a new function from an existing one by fixing some values.  You can fix one or more parameters, and the number of fixed parameters defines the arity of the new function such that <code>new arity = (original arity - fixed parameters)</code>.  The parameters are bound from left to right.</p>
</div>
<div class="paragraph">
<p>関数の引数の一部を固定した新しい関数を生成するのが部分適用です。<br>
固定する引数は1つでも2つでも構いません（任意です）。<br>
固定した引数の数が、新しく生成した関数のアリティになります（<code>新しい関数のアリティ = 元の関数のアリティ - 固定した引数の数</code>）。<br>
引数は左から右に向かって固定できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Function2&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; sum = (a, b) -&gt; a + b;
Function1&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; add2 = sum.apply(<span class="integer">2</span>); <i class="conum" data-value="1"></i><b>(1)</b>

then(add2.apply(<span class="integer">4</span>)).isEqualTo(<span class="integer">6</span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>最初の引数 <code>a</code> を値 2 で固定します。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This can be demonstrated by fixing the first three parameters of a <code>Function5</code>, resulting in a <code>Function2</code>.</p>
</div>
<div class="paragraph">
<p>具体的には、<code>Function5</code> の最初の3つの引数を固定すると <code>Function2</code> になります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Function5&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; sum = (a, b, c, d, e) -&gt; a + b + c + d + e;
Function2&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; add6 = sum.apply(<span class="integer">2</span>, <span class="integer">3</span>, <span class="integer">1</span>); <i class="conum" data-value="1"></i><b>(1)</b>

then(add6.apply(<span class="integer">4</span>, <span class="integer">3</span>)).isEqualTo(<span class="integer">13</span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>引数 <code>a</code> <code>b</code> <code>c</code> を、それぞれ値 2 3 1 で固定します。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Partial application differs from <a href="#_カリー化">Currying</a>, as will be explored in the relevant section.</p>
</div>
<div class="paragraph">
<p>部分適用と<a href="#_カリー化">Currying</a>は別の概念です。カリー化について詳しくは後で説明します。</p>
</div>
</div>
<div class="sect3">
<h4 id="_カリー化">3.2.4. カリー化</h4>
<div class="paragraph">
<p>Currying is a technique to partially apply a function by fixing a value for one of the parameters, resulting in a <code>Function1</code> function that returns a <code>Function1</code>.</p>
</div>
<div class="paragraph">
<p>カリー化とは、関数にいずれかの引数を部分適用するテクニックのことで、<code>Function1</code> をカリー化すると <code>Function1</code> を返すことになります。</p>
</div>
<div class="paragraph">
<p>When a <code>Function2</code> is <em>curried</em>, the result is indistinguishable from the <em>partial application</em> of a <code>Function2</code> because both result in a 1-arity function.</p>
</div>
<div class="paragraph">
<p><code>Function2</code> を <em>カリー化</em> した結果は、<em>部分適用</em> の考え方では区別できません。<br>
なぜなら、<code>Function2</code> には引数が2つあるため、どちらの引数を固定しても、アリティが1の関数になるからです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Function2&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; sum = (a, b) -&gt; a + b;
Function1&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; add2 = sum.curried().apply(<span class="integer">2</span>); <i class="conum" data-value="1"></i><b>(1)</b>

then(add2.apply(<span class="integer">4</span>)).isEqualTo(<span class="integer">6</span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>最初の引数 <code>a</code> を値 2 で固定します。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You might notice that, apart from the use of <code>.curried()</code>, this code is identical to the 2-arity given example in <a href="#_部分適用">Partial application</a>.  With higher-arity functions, the difference becomes clear.</p>
</div>
<div class="paragraph">
<p><code>.curried()</code> を使っていること以外は <a href="#_部分適用">Partial application</a> のコード例とまったく変わらないことに気付いたでしょうか。<br>
アリティの高い関数なら違いが明確になります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Function3&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; sum = (a, b, c) -&gt; a + b + c;
<span class="directive">final</span> Function1&lt;<span class="predefined-type">Integer</span>, Function1&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt;&gt; add2 = sum.curried().apply(<span class="integer">2</span>);<i class="conum" data-value="1"></i><b>(1)</b>

then(add2.apply(<span class="integer">4</span>).apply(<span class="integer">3</span>)).isEqualTo(<span class="integer">9</span>); <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>新しい関数にはまだ2つ引数が必要です。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>1つ目の <code>apply</code> は新たな <code>Function1</code> を生成します。2つ目の <code>apply</code> は結果を返します。</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_メモ化">3.2.5. メモ化</h4>
<div class="paragraph">
<p>Memoization is a form of caching. A memoized function executes only once and then returns the result from a cache.<br>
The following example calculates a random number on the first invocation and returns the cached number on the second invocation.</p>
</div>
<div class="paragraph">
<p>メモ化とはキャッシュの一種です。<br>
メモ化した関数は最初の呼び出しだけ実際に計算し、それ以降の呼び出しではキャッシュした結果を返します。<br>
次のコード例は、最初の呼び出しでランダムな数値を計算して、それ以降の呼び出しではキャッシュした結果を返しています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Function0&lt;<span class="predefined-type">Double</span>&gt; hashCache =
        Function0.of(<span class="predefined-type">Math</span>::random).memoized();

<span class="type">double</span> randomValue1 = hashCache.apply();
<span class="type">double</span> randomValue2 = hashCache.apply();

then(randomValue1).isEqualTo(randomValue2);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_値">3.3. 値</h3>
<div class="paragraph">
<p>In a functional setting we see a value as a kind of <a href="https://en.wikipedia.org/wiki/Normal_form_(abstract_rewriting)">normal form</a>, an expression which cannot be further evaluated. In Java we express this by making the state of an object final and call it <a href="https://en.wikipedia.org/wiki/Immutable_object">immutable</a>.<br>
Vavr&#8217;s functional Value abstracts over immutable objects. Efficient write operations are added by sharing immutable memory between instances. What we get is thread-safety for free!<br>
関数型プログラミングでは、値を <a href="https://en.wikipedia.org/wiki/Normal_form_(abstract_rewriting)">正規形</a> として扱います。<br>
つまり、1度しか評価できない式と同じ扱いなのです。<br>
Java では final にしたオブジェクトに相当し、これを <a href="https://en.wikipedia.org/wiki/Immutable_object">不変オブジェクト</a> と呼びます。<br>
Vavr の抽象としての値は、不変オブジェクトより多くの機能を提供します。<br>
インスタンス間で不変オブジェクトを共有する、より効率的な書き込み操作ができるようになっているのです。<br>
これは、スレッド安全性を獲得するのに役立ちました。</p>
</div>
<div class="sect3">
<h4 id="_option">3.3.1. Option</h4>
<div class="paragraph">
<p>Option is a monadic container type which represents an optional value. Instances of Option are either an instance of <code>Some</code> or the <code>None</code>.</p>
</div>
<div class="paragraph">
<p>Optionはモナドのコンテナ型で、任意の値の存在を表現します。<br>
Optionのインスタンスは、<code>Some</code> のインスタンスか <code>None</code> のいずれかになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// optional *value*, no more nulls</span>
<span class="predefined-type">Option</span>&lt;T&gt; option = <span class="predefined-type">Option</span>.of(...);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you&#8217;re coming to Vavr after using Java&#8217;s <code>Optional</code> class, there is a crucial difference.  In <code>Optional</code>, a call to <code>.map</code> that results in a null will result in an empty <code>Optional</code>.  In Vavr, it would result in a <code>Some(null)</code> that can then lead to a <code>NullPointerException</code>.</p>
</div>
<div class="paragraph">
<p>Java の <code>Optional</code> を知ってから Vavr を使い始めたとしたら、決定的な違いがあることに気付いているでしょう。<br>
空の <code>Optional</code> について <code>.map</code> で値を取り出すと、null が返ってくるのです。<br>
Vavr では <code>Some(null)</code> から値を取り出そうとすると <code>NullPointerException</code> を送出します。</p>
</div>
<div class="paragraph">
<p>Using <code>Optional</code>, this scenario is valid.</p>
</div>
<div class="paragraph">
<p>次のコード例は <code>Optional</code> なら正しい使い方です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Optional&lt;<span class="predefined-type">String</span>&gt; maybeFoo = Optional.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="1"></i><b>(1)</b>
then(maybeFoo.get()).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>);
Optional&lt;<span class="predefined-type">String</span>&gt; maybeFooBar = maybeFoo.map(s -&gt; (<span class="predefined-type">String</span>)<span class="predefined-constant">null</span>)  <i class="conum" data-value="2"></i><b>(2)</b>
                                       .map(s -&gt; s.toUpperCase() + <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>);
then(maybeFooBar.isPresent()).isFalse();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Optionでは <code>Some("foo")</code> と同じ意味になります。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>この行のせいで、最終的なOptionは空になります。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using Vavr&#8217;s <code>Option</code>, the same scenario will result in a <code>NullPointerException</code>.</p>
</div>
<div class="paragraph">
<p>Vavr の <code>Option</code> で同じことをすると <code>NullPointerException</code> を送出します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Option</span>&lt;<span class="predefined-type">String</span>&gt; maybeFoo = <span class="predefined-type">Option</span>.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="1"></i><b>(1)</b>
then(maybeFoo.get()).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">try</span> {
    maybeFoo.map(s -&gt; (<span class="predefined-type">String</span>)<span class="predefined-constant">null</span>) <i class="conum" data-value="2"></i><b>(2)</b>
            .map(s -&gt; s.toUpperCase() + <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="3"></i><b>(3)</b>
    Assert.fail();
} <span class="keyword">catch</span> (<span class="exception">NullPointerException</span> e) {
    <span class="comment">// this is clearly not the correct approach</span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Optionは <code>Some("foo")</code> になります。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Optionは <code>Some(null)</code> になります。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>null</code> に対して <code>s.toUpperCase()</code> を呼び出したことになります。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This seems like Vavr&#8217;s implementation is broken, but in fact it&#8217;s not - rather, it adheres to the requirement of a monad to maintain computational context when calling <code>.map</code>.  In terms of an <code>Option</code>, this means that calling <code>.map</code> on a <code>Some</code> will result in a <code>Some</code>, and calling <code>.map</code> on a <code>None</code> will result in a <code>None</code>.  In the Java <code>Optional</code> example above, that context changed from a <code>Some</code> to a <code>None</code>.</p>
</div>
<div class="paragraph">
<p>Vavr の実装が間違っていると思うかもしれませんが、そんなことはありません。<br>
それどころか、モナドの要求する <code>.map</code> を呼ぶときの計算の文脈を守っているのです。<br>
<code>Option</code> の定義では、<code>Some</code> について <code>.map</code> を呼び出した結果は <code>Some</code> になりますし、<code>None</code> について <code>.map</code> を呼び出した結果は <code>None</code> になるからです。<br>
Java の <code>Optional</code> では、<code>Some</code> から <code>None</code> へ文脈が変化してしまっているのです。</p>
</div>
<div class="paragraph">
<p>This may seem to make <code>Option</code> useless, but it actually forces you to pay attention to possible occurrences of <code>null</code> and deal with them accordingly instead of unknowingly accepting them.  The correct way to deal with occurrences of <code>null</code> is to use <code>flatMap</code>.</p>
</div>
<div class="paragraph">
<p><code>Option</code> が使いにくいと感じるかもしれませんが、この制限は <code>null</code> の発生する可能性について注意を促すことになるし、未知の値を無視せず、適切に扱えるようにしてくれます。<br>
<code>null</code> の発生する場合を考慮する正しい方法は <code>flatMap</code> を使う方法です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Option</span>&lt;<span class="predefined-type">String</span>&gt; maybeFoo = <span class="predefined-type">Option</span>.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="1"></i><b>(1)</b>
then(maybeFoo.get()).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Option</span>&lt;<span class="predefined-type">String</span>&gt; maybeFooBar = maybeFoo.map(s -&gt; (<span class="predefined-type">String</span>)<span class="predefined-constant">null</span>) <i class="conum" data-value="2"></i><b>(2)</b>
                                     .flatMap(s -&gt; <span class="predefined-type">Option</span>.of(s) <i class="conum" data-value="3"></i><b>(3)</b>
                                                         .map(t -&gt; t.toUpperCase() + <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>));
then(maybeFooBar.isEmpty()).isTrue();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Optionは <code>Some("foo")</code> になります。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Optionは <code>Some(null)</code> になります。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>s</code> は <code>null</code> なので <code>None</code> になります。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, move the <code>.flatMap</code> to be co-located with the the possibly <code>null</code> value.</p>
</div>
<div class="paragraph">
<p>また、<code>null</code> の発生しそうな部分に <code>.flatMap</code> を移動してもいいでしょう。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Option</span>&lt;<span class="predefined-type">String</span>&gt; maybeFoo = <span class="predefined-type">Option</span>.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="1"></i><b>(1)</b>
then(maybeFoo.get()).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Option</span>&lt;<span class="predefined-type">String</span>&gt; maybeFooBar = maybeFoo.flatMap(s -&gt; <span class="predefined-type">Option</span>.of((<span class="predefined-type">String</span>)<span class="predefined-constant">null</span>)) <i class="conum" data-value="2"></i><b>(2)</b>
                                     .map(s -&gt; s.toUpperCase() + <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>);
then(maybeFooBar.isEmpty()).isTrue();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Optionは <code>Some("foo")</code> になります。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Optionは <code>None</code> になります。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is explored in more detail on the <a href="http://blog.vavr.io/the-agonizing-death-of-an-astronaut/">Vavr blog</a>.</p>
</div>
<div class="paragraph">
<p>この内容について、 <a href="http://blog.vavr.io/the-agonizing-death-of-an-astronaut/">Vavr のブログ</a> でより詳しく説明しています。</p>
</div>
</div>
<div class="sect3">
<h4 id="_try">3.3.2. Try</h4>
<div class="paragraph">
<p>Try is a monadic container type which represents a computation that may either result in an exception, or return a successfully computed value. It&#8217;s similar to, but semantically different from <code>Either</code>. Instances of Try, are either an instance of <code>Success</code> or <code>Failure</code>.</p>
</div>
<div class="paragraph">
<p>Try はモナドのコンテナ型で、例外を送出するか、計算した値を返す計算を表現します。<br>
一見すると <code>Either</code> に似ていますが意味論的には異なります。<br>
Try のインスタンスは、<code>Success</code> か <code>Failure</code> のいずれかのインスタンスになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// no need to handle exceptions</span>
Try.of(() -&gt; bunchOfWork()).getOrElse(other);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">io.vavr.API</span>.*;        <span class="comment">// $, Case, Match</span>
<span class="keyword">import</span> <span class="include">static</span> <span class="include">io.vavr.Predicates</span>.*; <span class="comment">// instanceOf</span>

A result = Try.of(<span class="local-variable">this</span>::bunchOfWork)
    .recover(x -&gt; Match(x).of(
        Case(<span class="error">$</span>(instanceOf(Exception_1.class)), t -&gt; somethingWithException(t)),
        Case(<span class="error">$</span>(instanceOf(Exception_2.class)), t -&gt; somethingWithException(t)),
        Case(<span class="error">$</span>(instanceOf(Exception_n.class)), t -&gt; somethingWithException(t))
    ))
    .getOrElse(other);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lazy">3.3.3. Lazy</h4>
<div class="paragraph">
<p>Lazy is a monadic container type which represents a lazy evaluated value. Compared to a Supplier, Lazy is memoizing, i.e. it evaluates only once and therefore is referentially transparent.</p>
</div>
<div class="paragraph">
<p>Lazy はモナドのコンテナ型で、遅延評価する値を表現します。<br>
Java の <code>Supplier</code> と違って、Lazy はメモ化により最初だけ評価して、それ以降は透過的に同じ値を参照するようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Lazy&lt;<span class="predefined-type">Double</span>&gt; lazy = Lazy.of(<span class="predefined-type">Math</span>::random);
lazy.isEvaluated(); <span class="comment">// = false</span>
lazy.get();         <span class="comment">// = 0.123 (random generated)</span>
lazy.isEvaluated(); <span class="comment">// = true</span>
lazy.get();         <span class="comment">// = 0.123 (memoized)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Since version 2.0.0 you may also create a real lazy value (works only with interfaces):</p>
</div>
<div class="paragraph">
<p>Vavr 2.0.0 からは、インターフェイスと組み合わせた場合だけ、本物の遅延評価を作ることができるようになりました。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">CharSequence</span> chars = Lazy.val(() -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Yay!</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">CharSequence</span>.class);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_either">3.3.4. Either</h4>
<div class="paragraph">
<p>Either represents a value of two possible types. An Either is either a Left or a Right. If the given Either is a Right and projected to a Left, the Left operations have no effect on the Right value. If the given Either is a Left and projected to a Right, the Right operations have no effect on the Left value. If a Left is projected to a Left or a Right is projected to a Right, the operations have an effect.</p>
</div>
<div class="paragraph">
<p>Either は2種類の型として解釈可能な値を表現します。<br>
ある Either は Left と Right のいずれかになりうるということです。<br>
ある Eigher に Left へ射影した Right の値を指定した場合、Right としての値に Left の操作を適用しても効果はありません。<br>
ある Eigher に Right へ射影した Left の値を指定した場合、Left としての値に Right の操作を適用しても効果はありません。<br>
Left には Left の値を、Right には Right の値を射影した場合のみ、それぞれの操作を適用した場合の効果が発生します。</p>
</div>
<div class="paragraph">
<p>Example: A compute() function, which results either in an Integer value (in the case of success) or in an error message of type String (in the case of failure). By convention the success case is Right and the failure is Left.</p>
</div>
<div class="paragraph">
<p>例えば、正常時は Integer を、それ以外ではエラーメッセージ（String）を返す <code>compute()</code> という関数があるとします。<br>
慣習的に、正常時の返り値の型を Right、異常時の返り値の型を Left とすることになっています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Either&lt;<span class="predefined-type">String</span>,<span class="predefined-type">Integer</span>&gt; value = compute().right().map(i -&gt; i * <span class="integer">2</span>).toEither();</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the result of compute() is Right(1), the value is Right(2).<br>
If the result of compute() is Left("error"), the value is Left("error").</p>
</div>
<div class="paragraph">
<p><code>compute()</code> の結果が <code>Right(1)</code> なら <code>value</code> の値は <code>Right(2)</code> になります。<br>
<code>compute()</code> の結果が <code>Left("error")</code> なら <code>value</code> の値は <code>Left("error")</code> になります。</p>
</div>
</div>
<div class="sect3">
<h4 id="_future">3.3.5. Future</h4>
<div class="paragraph">
<p>A Future is a computation result that becomes available at some point. All operations provided are non-blocking. The underlying ExecutorService is used to execute asynchronous handlers, e.g. via onComplete(&#8230;&#8203;).</p>
</div>
<div class="paragraph">
<p>Future はある程度後になってから参照できるようになる計算結果です。<br>
Future に対する全ての操作は実行フローを中断しません。<br>
<code>onComplete(&#8230;&#8203;)</code> 等の非同期ハンドラを実行するため ExecutorService が使われています。</p>
</div>
<div class="paragraph">
<p>A Future has two states: pending and completed.</p>
</div>
<div class="paragraph">
<p>Future には保留（pending）と完了（completed）という2種類の状態があります。</p>
</div>
<div class="paragraph">
<p><strong>Pending:</strong> The computation is ongoing. Only a pending future may be completed or cancelled.</p>
</div>
<div class="paragraph">
<p><strong>Completed:</strong> The computation finished successfully with a result, failed with an exception or was cancelled.</p>
</div>
<div class="paragraph">
<p><strong>保留（Pending）</strong> 計算を実行中です。保留の Future は完了（completed）あるいは中断（cancelled）のいずれかになります。</p>
</div>
<div class="paragraph">
<p><strong>完了（Completed）</strong> 計算は完了しており、正常時はその結果を、異常時は例外を保持しています。中断（cancelled）している場合もあります。</p>
</div>
<div class="paragraph">
<p>Callbacks may be registered on a Future at each point of time. These actions are performed as soon as the Future is completed. An action which is registered on a completed Future is immediately performed. The action may run on a separate Thread, depending on the underlying ExecutorService. Actions which are registered on a cancelled Future are performed with the failed result.</p>
</div>
<div class="paragraph">
<p>Future には所定の時点に対応するコールバック操作を登録できます。<br>
コールバックに登録した操作は Future が完了した時点ですぐに実行されます。<br>
すでに完了した Future のコールバックに登録した操作はすぐに実行されます。<br>
ExecutorService によっては、コールバックに登録した操作を別のスレッドで実行します。<br>
中断した Future のコールバックに登録した操作は、失敗時の結果と共に実行されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// future *value*, result of an async calculation</span>
<span class="predefined-type">Future</span>&lt;T&gt; future = <span class="predefined-type">Future</span>.of(...);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_validation">3.3.6. Validation</h4>
<div class="paragraph">
<p>The Validation control is an <em>applicative functor</em> and facilitates accumulating errors. When trying to compose Monads, the combination process will short circuit at the first encountered error. But 'Validation' will continue processing the combining functions, accumulating all errors. This is especially useful when doing validation of multiple fields, say a web form, and you want to know all errors encountered, instead of one at a time.</p>
</div>
<div class="paragraph">
<p>Validation は <em>アプリケイティブファンクタ</em> およびエラーを蓄積する仕組みとして使われます。<br>
モナドを合成するとき、合成プロセスは最初にエラーを検出した時点で短絡させます。<br>
ですが、Validation は合成した全ての関数の実行を継続し、全てのエラーを蓄積します。<br>
Web フォームのように複数のフィールドを検証するときや、全てのエラーを同時に確認したいときに役立つ機能です。</p>
</div>
<div class="paragraph">
<p>Example: We get the fields 'name' and 'age' from a web form and want to create either a valid Person instance, or return the list of validation errors.</p>
</div>
<div class="paragraph">
<p>Web フォームの 'name' フィールドと 'age' フィールドについて、正常な Person インスタンスを作成するか、検証エラーのリストを返したいときは次のようの記述します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">PersonValidator personValidator = <span class="keyword">new</span> PersonValidator();

<span class="comment">// Valid(Person(John Doe, 30))</span>
Validation&lt;Seq&lt;<span class="predefined-type">String</span>&gt;, Person&gt; valid = personValidator.validatePerson(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>, <span class="integer">30</span>);

<span class="comment">// Invalid(List(Name contains invalid characters: '!4?', Age must be greater than 0))</span>
Validation&lt;Seq&lt;<span class="predefined-type">String</span>&gt;, Person&gt; invalid = personValidator.validatePerson(<span class="string"><span class="delimiter">&quot;</span><span class="content">John? Doe!4</span><span class="delimiter">&quot;</span></span>, -<span class="integer">1</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>A valid value is contained in a <code>Validation.Valid</code> instance, a list of validation errors is contained in a <code>Validation.Invalid</code> instance.</p>
</div>
<div class="paragraph">
<p><code>Validation.Valid</code> のインスタンスには正しい値を格納します。<br>
<code>Validation.Invalid</code> のインスタンスには検証エラーのリストを格納します。</p>
</div>
<div class="paragraph">
<p>The following validator is used to combine different validation results to one <code>Validation</code> instance.</p>
</div>
<div class="paragraph">
<p>次のコード例では複数の異なる <code>Validation</code> インスタンスを合成するバリデーターを定義しています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>class PersonValidator {

    private static final String VALID_NAME_CHARS = "[a-zA-Z ]";
    private static final int MIN_AGE = 0;

    public Validation&lt;Seq&lt;String&gt;, Person&gt; validatePerson(String name, int age) {
        return Validation.combine(validateName(name), validateAge(age)).ap(Person::new);
    }

    private Validation&lt;String, String&gt; validateName(String name) {
        return CharSeq.of(name).replaceAll(VALID_NAME_CHARS, "").transform(seq -&gt; seq.isEmpty()
                ? Validation.valid(name)
                : Validation.invalid("Name contains invalid characters: '"
                + seq.distinct().sorted() + "'"));
    }

    private Validation&lt;String, Integer&gt; validateAge(int age) {
        return age &lt; MIN_AGE
                ? Validation.invalid("Age must be at least " + MIN_AGE)
                : Validation.valid(age);
    }

}</pre>
</div>
</div>
<div class="paragraph">
<p>If the validation succeeds, i.e. the input data is valid, then an instance of <code>Person</code> is created of the given fields <code>name</code> and <code>age</code>.</p>
</div>
<div class="paragraph">
<p>入力値が正しいとき、つまり検証が成功したら、<code>name</code> と <code>age</code> に値を設定した <code>Person</code> のインスタンスを生成します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>class Person {

    public final String name;
    public final int age;

    public Person(String name, int age) {
        this.name = name;
        this.age = age;
    }

    @Override
    public String toString() {
        return "Person(" + name + ", " + age + ")";
    }

}</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_コレクション">3.4. コレクション</h3>
<div class="paragraph">
<p>Much effort has been put into designing an all-new collection library for Java which meets the requirements of functional programming, namely immutability.</p>
</div>
<div class="paragraph">
<p>関数型プログラミングの要求を満たす、つまり、不変性を満たすように、Java の新しいコレクションライブラリを設計するのはとても大変でした。</p>
</div>
<div class="paragraph">
<p>Java&#8217;s Stream lifts a computation to a different layer and links to a specific collection in another explicit step. With Vavr we don&#8217;t need all this additional boilerplate.</p>
</div>
<div class="paragraph">
<p>Java の Stream は計算処理を別のレイヤーへ引き上げたり、コレクションと別の処理を結びつけたりするものでした。<br>
Vavr では新たに定型的なコードを追加する必要がありません。</p>
</div>
<div class="paragraph">
<p>The new collections are based on <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Iterable.html">java.lang.Iterable</a>, so they leverage the sugared iteration style.</p>
</div>
<div class="paragraph">
<p>Vavr の提供するコレクションライブラリは <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Iterable.html">java.lang.Iterable</a> に基づいています。<br>
ですので、イテレーションに関する糖衣構文を利用できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// 1000 random numbers</span>
<span class="keyword">for</span> (<span class="type">double</span> random : Stream.continually(<span class="predefined-type">Math</span>::random).take(<span class="integer">1000</span>)) {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>TraversableOnce</code> has a huge amount of useful functions to operate on the collection. Its API is similar to <a href="http://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html">java.util.stream.Stream</a> but more mature.</p>
</div>
<div class="paragraph">
<p><code>TraversableOnce</code> はコレクションの操作に役立つさまざまな関数を持っています。<br>
<a href="http://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html">java.util.stream.Stream</a> とよく似た API を提供していますが、より洗練されています。</p>
</div>
<div class="sect3">
<h4 id="_リスト">3.4.1. リスト</h4>
<div class="paragraph">
<p>Vavr&#8217;s <code>List</code> is an immutable linked list. Mutations create new instances. Most operations are performed in linear time. Consequent operations are executed one by one.</p>
</div>
<div class="paragraph">
<p>Vavr の <code>List</code> は不変連結リストです。<br>
変更操作は新しいインスタンスを作成します。<br>
ほとんどの操作は線形時間で完了します。<br>
結果の生じる操作は1つずつ実行します。</p>
</div>
<div class="sect4">
<h5 id="_java_8">Java 8</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Arrays</span>.asList(<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>).stream().reduce((i, j) -&gt; i + j);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">IntStream.of(<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>).sum();</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_vavr">Vavr</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// io.vavr.collection.List</span>
<span class="predefined-type">List</span>.of(<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>).sum();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ストリーム">3.4.2. ストリーム</h4>
<div class="paragraph">
<p>The <code>io.vavr.collection.Stream</code> implementation is a lazy linked list. Values are computed only when needed. Because of its laziness, most operations are performed in constant time. Operations are intermediate in general and executed in a single pass.</p>
</div>
<div class="paragraph">
<p><code>io.vavr.collection.Stream</code> は遅延連結リストとして実装されています。<br>
必要になったときだけ値を計算します。<br>
遅延評価できるため、ほとんどの操作は定数時間で完了します。<br>
ほとんどの操作には中間処理が介入するし、単一の経路で実行します。</p>
</div>
<div class="paragraph">
<p>The stunning thing about streams is that we can use them to represent sequences that are (theoretically) infinitely long.<br>
ストリームに驚かされるのは、（理論的に）無限長のシーケンスを表現できることです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// 2, 4, 6, ...</span>
Stream.from(<span class="integer">1</span>).filter(i -&gt; i % <span class="integer">2</span> == <span class="integer">0</span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_性能特性">3.4.3. 性能特性</h4>
<table class="tableblock frame-topbot grid-all spread">
<caption class="title">Table 1. 順次処理の時間計算量（Time Complexity of Sequential Operations）</caption>
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">head()</th>
<th class="tableblock halign-left valign-top">tail()</th>
<th class="tableblock halign-left valign-top">get(int)</th>
<th class="tableblock halign-left valign-top">update(int, T)</th>
<th class="tableblock halign-left valign-top">prepend(T)</th>
<th class="tableblock halign-left valign-top">append(T)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">線形</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">線形</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">線形</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CharSeq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">線形</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">線形</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">線形</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">線形</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Iterator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&mdash;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&mdash;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&mdash;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&mdash;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">線形</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">線形</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">線形</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Queue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">（償却あり）定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">線形</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">線形</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PriorityQueue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&mdash;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&mdash;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stream</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">線形</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">線形</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">（遅延評価）定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">（遅延評価）定数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vector</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">（実質的に）定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">（実質的に）定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">（実質的に）定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">（実質的に）定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">（実質的に）定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">（実質的に）定数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-topbot grid-all spread">
<caption class="title">Table 2. マップ、セット処理の時間計算量（Time Complexity of Map/Set Operations）</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">contains/Key</th>
<th class="tableblock halign-left valign-top">add/put</th>
<th class="tableblock halign-left valign-top">remove</th>
<th class="tableblock halign-left valign-top">min</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HashMap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">（実質的に）定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">（実質的に）定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">（実質的に）定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">線形</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HashSet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">（実質的に）定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">（実質的に）定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">（実質的に）定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">線形</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LinkedHashMap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">（実質的に）定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">線形</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">線形</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">線形</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LinkedHashSet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">（実質的に）定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">線形</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">線形</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">線形</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tree</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TreeMap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TreeSet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対数</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>セルの値の意味は以下のとおり。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>定数 &mdash; 定数時間</p>
</li>
<li>
<p>（償却あり）定数 &mdash; 一部の処理により多くの時間はかかるけど、大半は定数時間</p>
</li>
<li>
<p>（実質的に）定数 &mdash; ハッシュキーの分布に依存するけど実質的に定数時間</p>
</li>
<li>
<p>（遅延評価）定数 &mdash; 操作は遅延処理されるので定数時間</p>
</li>
<li>
<p>対数 &mdash; 対数時間</p>
</li>
<li>
<p>線形 &mdash; 線形時間</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_プロパティチェック">3.5. プロパティチェック</h3>
<div class="paragraph">
<p>Property checking (also known as <a href="http://en.wikipedia.org/wiki/Property_testing">property testing</a>) is a truly powerful way to test properties of our code in a functional way. It is based on generated random data, which is passed to a user defined check function.</p>
</div>
<div class="paragraph">
<p>プロパティチェック（ <a href="http://en.wikipedia.org/wiki/Property_testing">プロパティテスト</a> とも呼ばれている）は、関数型プログラミングにおける、自分で書いたソースコードの特徴を検証する強力は手法です。</p>
</div>
<div class="paragraph">
<p>Vavr has property testing support in its <code>io.vavr:vavr-test</code> module, so make sure to include that in order to use it in your tests.</p>
</div>
<div class="paragraph">
<p>Vavr の <code>io.vavr:vavr-test</code> モジュールはプロパティテストに対応しているので、テストに導入するのは簡単です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Arbitrary&lt;<span class="predefined-type">Integer</span>&gt; ints = Arbitrary.integer();

<span class="comment">// square(int) &gt;= 0: OK, passed 1000 tests.</span>
Property.def(<span class="string"><span class="delimiter">&quot;</span><span class="content">square(int) &gt;= 0</span><span class="delimiter">&quot;</span></span>)
        .forAll(ints)
        .suchThat(i -&gt; i * i &gt;= <span class="integer">0</span>)
        .check()
        .assertIsSatisfied();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Generators of complex data structures are composed of simple generators.</p>
</div>
<div class="paragraph">
<p>単純なジェネレーターを合成すれば、複雑なデータ構造のジェネレーターを構築できます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_パターンマッチ">3.6. パターンマッチ</h3>
<div class="paragraph">
<p>Scala has native pattern matching, one of the advantages over <em>plain</em> Java. The basic syntax is close to Java&#8217;s switch:</p>
</div>
<div class="paragraph">
<p>Scala は言語としてパターンマッチングに対応しているところが、<em>素の</em> Java に対する利点の1つになっています。<br>
基本的な構文は Java の switch 文によく似ています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">val s = i match {
  <span class="keyword">case</span> <span class="integer">1</span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span>
  <span class="keyword">case</span> <span class="integer">2</span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">two</span><span class="delimiter">&quot;</span></span>
  <span class="keyword">case</span> _ =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">?</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notably <em>match</em> is an expression, it yields a result. Furthermore it offers</p>
</div>
<div class="ulist">
<ul>
<li>
<p>named parameters <code>case i: Int &#8658; "Int " + i</code></p>
</li>
<li>
<p>object deconstruction <code>case Some(i) &#8658; i</code></p>
</li>
<li>
<p>guards <code>case Some(i) if i &gt; 0 &#8658; "positive " + i</code></p>
</li>
<li>
<p>multiple conditions <code>case "-h" | "--help" &#8658; displayHelp</code></p>
</li>
<li>
<p>compile-time checks for exhaustiveness</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>match</em> は式として値を返すところが重要です。次のように記述できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>名前付きパラメータ <code>case i: Int &#8658; "Int " + i</code></p>
</li>
<li>
<p>オブジェクトの解体 <code>case Some(i) &#8658; i</code></p>
</li>
<li>
<p>ガード節 <code>case Some(i) if i &gt; 0 &#8658; "positive " + i</code></p>
</li>
<li>
<p>複数の条件式 <code>case "-h" | "--help" &#8658; displayHelp</code></p>
</li>
<li>
<p>コンパイル時の網羅性チェック（exhaustiveness）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Pattern matching is a great feature that saves us from writing stacks of if-then-else branches. It reduces the amount of code while focusing on the relevant parts.</p>
</div>
<div class="paragraph">
<p>パターンマッチングは if-then-else の条件分岐を無駄に積み重ねるのを減らしてくれる素敵な機能です。<br>
コード量を減らすことで、重要な部分に注力できるからです。</p>
</div>
<div class="sect3">
<h4 id="_java_におけるパターンマッチの基本">3.6.1. Java におけるパターンマッチの基本</h4>
<div class="paragraph">
<p>Vavr provides a match API that is close to Scala&#8217;s match. It is enabled by adding the following import to our application:</p>
</div>
<div class="paragraph">
<p>Vavr は Scala の match によく似た match API を提供します。<br>
次のような import 文を追加するだけで利用できるようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">io.vavr.API</span>.*;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Having the static methods <em>Match</em>, <em>Case</em> and the <em>atomic patterns</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$()</code> - wildcard pattern</p>
</li>
<li>
<p><code>$(value)</code> - equals pattern</p>
</li>
<li>
<p><code>$(predicate)</code> - conditional pattern</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>そうすると <em>Match</em> や <em>Case</em> といった静的メソッドや、次のような <em>_atomic パターン</em> が使えるようになります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$()</code> - ワイルドカードパターン</p>
</li>
<li>
<p><code>$(value)</code> - 等値パターン</p>
</li>
<li>
<p><code>$(predicate)</code> - 条件式パターン</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>in scope, the initial Scala example can be expressed like this:</p>
</div>
<div class="paragraph">
<p>前に説明した Scala のコード例は次のように記述できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> s = Match(i).of(
    Case(<span class="error">$</span>(<span class="integer">1</span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span>),
    Case(<span class="error">$</span>(<span class="integer">2</span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">two</span><span class="delimiter">&quot;</span></span>),
    Case(<span class="error">$</span>(), <span class="string"><span class="delimiter">&quot;</span><span class="content">?</span><span class="delimiter">&quot;</span></span>)
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>⚡ We use uniform upper-case method names because 'case' is a keyword in Java. This makes the API special.</p>
</div>
<div class="paragraph">
<p>⚡ Java では 'case' が予約語になっているため、メソッド名は大文字で始める形式に統一しています。APIとして分かりやすくなっていると思います。</p>
</div>
<div class="sect4">
<h5 id="_網羅性チェック">網羅性チェック</h5>
<div class="paragraph">
<p>The last wildcard pattern <code>$()</code> saves us from a MatchError which is thrown if no case matches.</p>
</div>
<div class="paragraph">
<p>ワイルドカードパターン <code>$()</code> を使う限り、マッチしなかったときに MatchError を送出しないようになります。</p>
</div>
<div class="paragraph">
<p>Because we can&#8217;t perform exhaustiveness checks like the Scala compiler, we provide the possibility to return an optional result:</p>
</div>
<div class="paragraph">
<p>Scala コンパイラのように網羅性をチェックしないので、Option を返す可能性を表現するようにしています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Option</span>&lt;<span class="predefined-type">String</span>&gt; s = Match(i).option(
    Case(<span class="error">$</span>(<span class="integer">0</span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">zero</span><span class="delimiter">&quot;</span></span>)
);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_糖衣構文">糖衣構文</h5>
<div class="paragraph">
<p>As already shown, <code>Case</code> allows to match conditional patterns.</p>
</div>
<div class="paragraph">
<p><code>Case</code> を使うと条件式パターンにマッチさせることができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Case(<span class="error">$</span>(predicate), ...)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Vavr offers a set of default predicates.</p>
</div>
<div class="paragraph">
<p>Vavr の定義済み述語式を使うには次のような import 文を追加します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">io.vavr.Predicates</span>.*;</code></pre>
</div>
</div>
<div class="paragraph">
<p>These can be used to express the initial Scala example as follows:</p>
</div>
<div class="paragraph">
<p>Vavr の定義済み述語式を使うと、最初の Scala のコード例は次のように記述できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> s = Match(i).of(
    Case(<span class="error">$</span>(is(<span class="integer">1</span>)), <span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span>),
    Case(<span class="error">$</span>(is(<span class="integer">2</span>)), <span class="string"><span class="delimiter">&quot;</span><span class="content">two</span><span class="delimiter">&quot;</span></span>),
    Case(<span class="error">$</span>(), <span class="string"><span class="delimiter">&quot;</span><span class="content">?</span><span class="delimiter">&quot;</span></span>)
);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>複数の条件</strong></p>
</div>
<div class="paragraph">
<p>We use the <code>isIn</code> predicate to check multiple conditions:</p>
</div>
<div class="paragraph">
<p><code>isIn</code> 述語式は複数の条件をチェックできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Case(<span class="error">$</span>(isIn(<span class="string"><span class="delimiter">&quot;</span><span class="content">-h</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">--help</span><span class="delimiter">&quot;</span></span>)), ...)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>副作用を引き起こす</strong></p>
</div>
<div class="paragraph">
<p>Match acts like an expression, it results in a value. In order to perform side-effects we need to use the helper function <code>run</code> which returns <code>Void</code>:</p>
</div>
<div class="paragraph">
<p>Match は式なので値を返します。<br>
副作用を引き起こすには、<code>Void</code> を返すヘルパー関数 <code>run</code> を使わなければなりません。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Match(arg).of(
    Case(<span class="error">$</span>(isIn(<span class="string"><span class="delimiter">&quot;</span><span class="content">-h</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">--help</span><span class="delimiter">&quot;</span></span>)), o -&gt; run(<span class="local-variable">this</span>::displayHelp)),
    Case(<span class="error">$</span>(isIn(<span class="string"><span class="delimiter">&quot;</span><span class="content">-v</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">--version</span><span class="delimiter">&quot;</span></span>)), o -&gt; run(<span class="local-variable">this</span>::displayVersion)),
    Case(<span class="error">$</span>(), o -&gt; run(() -&gt; {
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>(arg);
    }))
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>⚡ <code>run</code> is used to get around ambiguities and because <code>void</code> isn&#8217;t a valid return value in Java.</p>
</div>
<div class="paragraph">
<p>⚡ <code>run</code> を使うのは曖昧性を解消するためです。なぜなら、Java では <code>void</code> が正しい返り値の型ではないからです。</p>
</div>
<div class="paragraph">
<p><strong>Caution:</strong> <code>run</code> must not be used as direct return value, i.e. outside of a lambda body:</p>
</div>
<div class="paragraph">
<p><strong>注意点：</strong> ラムダ式の外側で、直接値を返すために <code>run</code> を使ってはいけません。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Wrong!</span>
Case(<span class="error">$</span>(isIn(<span class="string"><span class="delimiter">&quot;</span><span class="content">-h</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">--help</span><span class="delimiter">&quot;</span></span>)), run(<span class="local-variable">this</span>::displayHelp))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Otherwise the Cases will be eagerly evaluated <em>before</em> the patterns are matched, which breaks the whole Match expression. Instead we use it within a lambda body:</p>
</div>
<div class="paragraph">
<p>Case の評価は貪欲評価です。<br>
つまりパターンを <em>マッチさせる前</em> に評価します。<br>
その結果、マッチ式全体が壊れてしまう場合もあります。<br>
そういうときはラムダ式の内側で <code>run</code> を使います。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Ok</span>
Case(<span class="error">$</span>(isIn(<span class="string"><span class="delimiter">&quot;</span><span class="content">-h</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">--help</span><span class="delimiter">&quot;</span></span>)), o -&gt; run(<span class="local-variable">this</span>::displayHelp))</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we can see, <code>run</code> is error prone if not used right. Be careful. We consider deprecating it in a future release and maybe we will also provide a better API for performing side-effects.</p>
</div>
<div class="paragraph">
<p>ここまでに見てきた通り、 <code>run</code> は間違った使い方をしやすい機能です。<br>
将来のリリースでは廃止して、副作用を引き起こすためのより適切な API を提供できないか検討するつもりです。</p>
</div>
</div>
<div class="sect4">
<h5 id="_名前付きパラメータ">名前付きパラメータ</h5>
<div class="paragraph">
<p>Vavr leverages lambdas to provide named parameters for matched values.</p>
</div>
<div class="paragraph">
<p>Vavr はパターンマッチングで名前付きパラメータを実現するため、ラムダ式を利用しています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Number</span> plusOne = Match(obj).of(
    Case(<span class="error">$</span>(instanceOf(<span class="predefined-type">Integer</span>.class)), i -&gt; i + <span class="integer">1</span>),
    Case(<span class="error">$</span>(instanceOf(<span class="predefined-type">Double</span>.class)), d -&gt; d + <span class="integer">1</span>),
    Case(<span class="error">$</span>(), o -&gt; { <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">NumberFormatException</span>(); })
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>So far we directly matched values using atomic patterns. If an atomic pattern matches, the right type of the matched object is inferred from the context of the pattern.</p>
</div>
<div class="paragraph">
<p>ある程度の複雑さになるまでは atomic パターンで直接値を記述できます。<br>
atomic パターンがマッチすれば、パターンのコンテキストから適切な型のマッチオブジェクトを推論します。</p>
</div>
<div class="paragraph">
<p>Next, we will take a look at recursive patterns that are able to match object graphs of (theoretically) arbitrary depth.</p>
</div>
<div class="paragraph">
<p>次は、（理論的には）任意の深さのオブジェクトグラフにマッチできる再帰的なパターンについて説明します。</p>
</div>
</div>
<div class="sect4">
<h5 id="_オブジェクトの解体">オブジェクトの解体</h5>
<div class="paragraph">
<p>In Java we use constructors to instantiate classes. We understand <em>object decomposition</em> as destruction of objects into their parts.</p>
</div>
<div class="paragraph">
<p>Java ではコンストラクタでクラスのインスタンスを作成します。<br>
<em>オブジェクトの解体</em> とは、オブジェクトを複数の部品へ分解するということです。</p>
</div>
<div class="paragraph">
<p>While a constructor is a <em>function</em> which is <em>applied</em> to arguments and returns a new instance, a deconstructor is a function which takes an instance and returns the parts. We say an object is <em>unapplied</em>.</p>
</div>
<div class="paragraph">
<p>複数の引数を <em>適用し</em> 新しいインスタンスを返す <em>関数</em> がコンストラクタだとすると、デコンストラクタはインスタンスを引数として、複数の値を返す関数だと考えられます。<br>
これを、オブジェクトを <em>逆適用した（unapplied）</em> と呼びます。</p>
</div>
<div class="paragraph">
<p>Object destruction is not necessarily a unique operation. For example, a LocalDate can be decomposed to</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the year, month and day components</p>
</li>
<li>
<p>the long value representing the epoch milliseconds of the corresponding Instant</p>
</li>
<li>
<p>etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>オブジェクトの解体は必ずしも単独の操作で実現しなければならないわけではありません。<br>
例えば、LocalDate は次のように分解できるでしょう。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>年、月、日、それぞれのコンポーネント</p>
</li>
<li>
<p>インスタントに対応する long のエポックミリ秒</p>
</li>
<li>
<p>それ以外</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_さまざまなパターン">3.6.2. さまざまなパターン</h4>
<div class="paragraph">
<p>In Vavr we use patterns to define how an instance of a specific type is deconstructed. These patterns can be used in conjunction with the Match API.</p>
</div>
<div class="paragraph">
<p>Vavr では特定の型のインスタンスをどのように解体するのか説明するパターンを定義します。<br>
これらのパターンは Match API と組み合わせて使用できます。</p>
</div>
<div class="sect4">
<h5 id="_定義済みのパターン">定義済みのパターン</h5>
<div class="paragraph">
<p>For many Vavr types there already exist match patterns. They are imported via</p>
</div>
<div class="paragraph">
<p>Vavr のほとんどの型には定義済みのパターンが存在します。<br>
次のような import 文を追加すれば使用できるようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">io.vavr.Patterns</span>.*;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example we are now able to match the result of a Try:</p>
</div>
<div class="paragraph">
<p>例えば Try の結果は次のようにマッチできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Match(_try).of(
    Case(<span class="error">$</span>Success(<span class="error">$</span>()), value -&gt; ...),
    Case(<span class="error">$</span>Failure(<span class="error">$</span>()), x -&gt; ...)
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>⚡ A first prototype of Vavr&#8217;s Match API allowed to extract a user-defined selection of objects from a match pattern. Without proper compiler support this isn&#8217;t practicable because the number of generated methods exploded exponentially. The current API makes the compromise that all patterns are matched but only the root patterns are <em>decomposed</em>.<br>
⚡ Vavr の最初のプロトタイプに含まれる Match API では、ユーザーの定義したフィールドを抽出できるのはパターンにマッチしたオブジェクトからだけでした。生成するメソッドが指数関数的に増加してしまうため、適切なコンパイラの支援がなければ実用的ではありませんでした。現在の API はその辺を妥協して全てのパターンにマッチはするけど親の（root の）パターンだけを <em>解体</em> するようになっています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Match(_try).of(
    Case(<span class="error">$</span>Success(Tuple2(<span class="error">$</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>), <span class="error">$</span>())), tuple2 -&gt; ...),
    Case(<span class="error">$</span>Failure(<span class="error">$</span>(instanceOf(<span class="exception">Error</span>.class))), error -&gt; ...)
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here the root patterns are Success and Failure. They are decomposed to Tuple2 and Error, having the correct generic types.</p>
</div>
<div class="paragraph">
<p>この場合親の（root の）パターンは <code>Success</code> と <code>Failure</code> です。<br>
それぞれより一般的な型の <code>Tuple2</code> と <code>Error</code> へ分解できます。</p>
</div>
<div class="paragraph">
<p>⚡ ネストした型を深くまで推論するのはマッチされた引数であって、マッチしたパターン <em>ではありません</em> 。</p>
</div>
</div>
<div class="sect4">
<h5 id="_ユーザー定義パターン">ユーザー定義パターン</h5>
<div class="paragraph">
<p>It is essential to be able to unapply arbitrary objects, including instances of final classes. Vavr does this in a declarative style by providing the compile time annotations <code>@Patterns</code> and <code>@Unapply</code>.</p>
</div>
<div class="paragraph">
<p>たとえそれが final クラスのオブジェクトであっても、オブジェクトを逆適用できるようにするのは必要不可欠です。<br>
Vavr では、コンパイル時に処理するアノテーション <code>@Patters</code> と <code>@Unapply</code> で宣言的に記述できるようにしました。</p>
</div>
<div class="paragraph">
<p>To enable the annotation processor the artifact <a href="http://search.maven.org/#search%7Cga%7C1%7Cvavr-match">vavr-match</a> needs to be added as project dependency.</p>
</div>
<div class="paragraph">
<p>アノテーションプロセッサを有効化するには <a href="https://mvnrepository.com/artifact/io.vavr/vavr-match">vavr-match</a> をプロジェクトの依存ライブラリに追加しなければなりません。</p>
</div>
<div class="paragraph">
<p>⚡ 注意点：当然ですが、パターンはコードジェネレータを使わなくても直接実装できます。詳しい内容については自動生成されたソースコードを参照してくｄさい。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.vavr.match.annotation</span>.*;

<span class="annotation">@Patterns</span>
<span class="type">class</span> <span class="class">My</span> {

    <span class="annotation">@Unapply</span>
    <span class="directive">static</span> &lt;T&gt; Tuple1&lt;T&gt; Optional(java.util.Optional&lt;T&gt; optional) {
        <span class="keyword">return</span> Tuple.of(optional.orElse(<span class="predefined-constant">null</span>));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotation processor places a file MyPatterns in the same package (by default in target/generated-sources). Inner classes are also supported. Special case: if the class name is $, the generated class name is just Patterns, without prefix.</p>
</div>
<div class="paragraph">
<p>アノテーションプロセッサは同じパッケージにファイル <code>MyPatterns</code> を作成します（デフォルトの作成位置は target/generated-sources です）。<br>
内部クラスにも対応しています。<br>
ただし、クラス名が <code>$</code> の場合、自動生成されたクラス名はただの <code>Patterns</code> になります。前置詞は付きません。</p>
</div>
</div>
<div class="sect4">
<h5 id="_ガード節">ガード節</h5>
<div class="paragraph">
<p>Now we are able to match Optionals using <em>guards</em>.</p>
</div>
<div class="paragraph">
<p>Option に対するマッチを <em>ガード節</em> として記述できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Match(optional).of(
    Case(<span class="error">$</span>Optional(<span class="error">$</span>(v -&gt; v != <span class="predefined-constant">null</span>)), <span class="string"><span class="delimiter">&quot;</span><span class="content">defined</span><span class="delimiter">&quot;</span></span>),
    Case(<span class="error">$</span>Optional(<span class="error">$</span>(v -&gt; v == <span class="predefined-constant">null</span>)), <span class="string"><span class="delimiter">&quot;</span><span class="content">empty</span><span class="delimiter">&quot;</span></span>)
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The predicates could be simplified by implementing <code>isNull</code> and <code>isNotNull</code>.</p>
</div>
<div class="paragraph">
<p>これらの述語式は <code>isNull</code> や <code>isNotNull</code> を実装すれば簡潔にできます。</p>
</div>
<div class="paragraph">
<p>⚡ And yes, extracting null is weird. Instead of using Java&#8217;s Optional give Vavr&#8217;s Option a try!<br>
⚡ もちろん、null の抽出にも結びついています。Java の Optional ではなく Vavr の Option を試してみましょう。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Match(option).of(
    Case(<span class="error">$</span>Some(<span class="error">$</span>()), <span class="string"><span class="delimiter">&quot;</span><span class="content">defined</span><span class="delimiter">&quot;</span></span>),
    Case(<span class="error">$</span>None(), <span class="string"><span class="delimiter">&quot;</span><span class="content">empty</span><span class="delimiter">&quot;</span></span>)
);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_license">4. License</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Copyright 2014-2018 Vavr, <a href="http://vavr.io" class="bare">http://vavr.io</a></p>
</div>
<div class="paragraph">
<p>Licensed under the Apache License, Version 2.0 (the "License");<br>
you may not use this file except in compliance with the License.<br>
You may obtain a copy of the License at</p>
</div>
<div class="paragraph">
<p><a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a></p>
</div>
<div class="paragraph">
<p>Unless required by applicable law or agreed to in writing, software<br>
distributed under the License is distributed on an "AS IS" BASIS,<br>
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.<br>
See the License for the specific language governing permissions and<br>
limitations under the License.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.10.3<br>
Last updated 2021-09-03 13:12:07 +09:00
</div>
</div>
</body>
</html>