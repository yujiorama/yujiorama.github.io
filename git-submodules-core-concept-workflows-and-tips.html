<!DOCTYPE html>
<!-- saved from url=(0065)http://blogs.atlassian.com/2013/03/git-submodules-workflows-tips/ -->
<html lang="en-US" class="wf-kulturistaweb1-i1-active wf-kulturistaweb1-i3-active wf-kulturistaweb1-i4-active wf-kulturistaweb1-i6-active wf-kulturistaweb1-i7-active wf-kulturistaweb1-n1-active wf-kulturistaweb1-n3-active wf-kulturistaweb1-n4-active wf-kulturistaweb1-n6-active wf-kulturistaweb1-n7-active wf-museoslab1-i3-active wf-museoslab1-i7-active wf-museoslab1-n3-active wf-museoslab1-n7-active wf-active">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>Git Submodules: Core Concept, Workflows And Tips | Atlassian Blogs</title>
  <link rel="stylesheet" type="text/css" media="all" href="http://atlassian.wpengine.netdna-cdn.com/wp-content/themes/atlassian/css/screen.css?version=05082013" />
  <!--[if IE]><link rel="stylesheet" type="text/css" href="http://atlassian.wpengine.netdna-cdn.com/wp-content/themes/atlassian/css/ie.css?version=01232012" /><![endif]-->
  <link rel="shortcut icon" href="http://atlassian.wpengine.netdna-cdn.com/favicon.ico" />
  <link rel="pingback" href="http://blogs.atlassian.com/xmlrpc.php" />

  <!--[if lt IE 9]><script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <!--[if lte IE 8]>
    <script type="text/javascript">
      document.createElement('header');
      document.createElement('hgroup');
      document.createElement('nav');
      document.createElement('menu');
      document.createElement('section');
      document.createElement('article');
      document.createElement('aside');
      document.createElement('footer');
    </script>
  <![endif]-->

  <link rel='stylesheet' id='prettify-css'  href='http://atlassian.wpengine.netdna-cdn.com/wp-content/plugins/prettify-code-syntax/stylesheets/default.css?ver=3.5.1' type='text/css' media='all' />
<link rel='stylesheet' id='codecolorer-css'  href='http://atlassian.wpengine.netdna-cdn.com/wp-content/plugins/codecolorer/codecolorer.css?ver=0.9.9' type='text/css' media='screen' />
<link rel='stylesheet' id='lightboxStyle-css'  href='http://atlassian.wpengine.netdna-cdn.com/wp-content/plugins/lightbox-plus/css/dark/colorbox.css?ver=2.0.2' type='text/css' media='screen' />
<link rel='stylesheet' id='wp-paginate-css'  href='http://atlassian.wpengine.netdna-cdn.com/wp-content/plugins/wp-paginate/wp-paginate.css?ver=1.2.4' type='text/css' media='screen' />
</head>
<body class="single single-post postid-24701 single-format-standard custom-background" data-twttr-rendered="true">
  <div id="page">
    <div id="main">
      <div id="content">
        <article id="post-24701" class="post-24701 post type-post status-publish format-standard hentry category-dvcs-3 tag-git tag-submodule tag-tips tag-workflow odd first-post">
          <div class="postheader">
            <h2>Git Submodules: Core Concept, Workflows And Tips</h2>
            <div class="postinfo">
              <a href="http://blogs.atlassian.com/author/npaolucci/"><img alt="" src="./Git Submodules  Core Concept, Workflows And Tips   Atlassian Blogs_files/cfed136c665e297b8bb1d004427e0aa2" class="avatar avatar-48 photo" height="48" width="48"></a>
              <ul>
                <li>By <a href="http://blogs.atlassian.com/author/npaolucci/">Nicola Paolucci</a>            </li>
                <li> <a href="http://blogs.atlassian.com/blog-cat/developer/">Developer</a>            </li>
                <li>On March 26, 2013</li>
              </ul>
            </div><!--/postinfo-->
          </div><!--/postheader-->
          <div class="postcontent">
            <p>Including submodules as part of your Git development allows you to include other projects in your codebase, keeping their history separate but synchronized with yours. It’s a convenient way to solve the vendor library and dependency problems. As usual with everything <span class="text codecolorer">git</span>, the approach is opinionated and encourages a bit of study before it can be used proficiently. There is already <a href="http://git-scm.com/book/en/Git-Tools-Submodules" target="_blank">good</a> and <a href="http://speirs.org/blog/2009/5/11/understanding-git-submodules.html" target="_blank">detailed</a> information about <span class="text codecolorer">submodules</span> out and about so I won’t rehash things. What I’ll do here is share some interesting things that will help you make the most of this feature.</p>
            <h2>Table Of Contents</h2>
            <ol>
              <li><a href="http://blogs.atlassian.com/2013/03/git-submodules-workflows-tips/#core">Core Concept</a></li>
              <li><a href="http://blogs.atlassian.com/2013/03/git-submodules-workflows-tips/#scenarios">Possible Workflows</a></li>
              <li><a href="http://blogs.atlassian.com/2013/03/git-submodules-workflows-tips/#tips-intro">Useful Tips Incoming</a></li>
              <li><a href="http://blogs.atlassian.com/2013/03/git-submodules-workflows-tips/#tip1">How to swap a git submodule with your own fork</a></li>
              <li><a href="http://blogs.atlassian.com/2013/03/git-submodules-workflows-tips/#tip2">How do I remove a submodule?</a></li>
              <li><a href="http://blogs.atlassian.com/2013/03/git-submodules-workflows-tips/#tip3">How do I integrate a submodule back into my project?</a></li>
              <li><a href="http://blogs.atlassian.com/2013/03/git-submodules-workflows-tips/#tip4">How to ignore changes in submodules</a></li>
              <li><a href="http://blogs.atlassian.com/2013/03/git-submodules-workflows-tips/#tip5">Danger Zone! Pitfalls Interacting with Remotes</a></li>
              <li><a href="http://blogs.atlassian.com/2013/03/git-submodules-workflows-tips/#conclusions">Conclusions</a></li>
            </ol>
            <h2 id="core">Core Concept</h2>
            <p>First, let me provide a brief explanation on a core concept about submodules that will make them easier to work with.</p>
            <p><strong>Submodules are tracked by the exact <em>commit</em> specified in the parent project, not a branch, a ref, or any other symbolic reference.</strong></p>
            <p>They are <em>never</em> automatically updated when the repository specified by the submodule is updated, only when the parent project itself is updated. As very clearly expressed in the <a href="http://git-scm.com/book/en/Git-Tools-Submodules" target="_blank">Pro Git chapter</a> mentioned earlier:</p>
            <blockquote>
              <p>When you make changes and commit in that \[submodule\] subdirectory, the<br>
                superproject notices that the HEAD there has changed and records the exact<br>
                commit you’re currently working off of; that way, when others clone this<br>
                project, they can re-create the environment exactly.</p>
            </blockquote>
            <p>Or in <a href="http://somethingsinistral.net/blog/git-submodules-are-probably-not-the-answer" target="_blank">other words</a> :</p>
            <blockquote>
              <p>\[...\] git submodules \[...\] are static. Very static.  You are tracking<br>
                specific commits with git submodules – not branches, not references, a single<br>
                commit. If you add commits to a submodule, the parent project won’t know. If<br>
                you have a bunch of forks of a module, git submodules don’t care. You have<br>
                one remote repository, and you point to a single commit.  Until you update<br>
                the parent project, nothing changes.</p>
            </blockquote>
            <h2 id="scenarios">Possible Workflows</h2>
            <p>By remembering this core concept and reflecting on it, you can understand that <span class="text codecolorer">submodule</span> support some workflows well and less optimally others.  There are at least three scenarios where submodules are a fair choice:</p>
            <ul>
              <li>
                <p>When a component or subproject is changing too fast or upcoming changes will break the API, you can lock the code to a specific commit for your own safety.</p>
              </li>
              <li>
                <p>When you have a component that isn’t updated very often and you want to track it as a vendor dependency. I do this for my <a href="https://bitbucket.org/durdn/cfg/src/2a79b298a32bf161d1813da9eba16e67a6a8ab1a/.vim/bundle?at=master" target="_blank">vim plugins</a> for example.</p>
              </li>
              <li>
                <p>When you are delegating a piece of the project to a third party and you want to integrate their work at a specific time or release. Again this works when updates are not too frequent.</p>
              </li>
            </ul>
            <p><a href="http://somethingsinistral.net/blog/git-submodules-are-probably-not-the-answer" target="_blank">Credit</a> to <em>finch</em> for the well-explained scenarios.</p>
            <h2 id="tips-intro">Useful Tips Incoming</h2>
            <p>The <a href="http://git-scm.com/book/en/Git-Tools-Submodules" target="_blank">submodule</a> infrastructure is powerful and allows for useful separation and integration of codebases. There are however simple operations that do not have a streamlined procedure or strong command line user interface support.</p>
            <p>If you use git submodules in your project you either have run into these or you will. When that happens you will have to look the solution up. Again and again.  Let me save you research time: <a href="http://www.instapaper.com/" target="_blank">Instapaper</a>, <a href="http://www.evernote.com/" target="_blank">Evernote</a> or old school <a href="http://support.mozilla.org/en-US/kb/use-bookmarks-to-save-and-organize-websites" target="_blank">bookmark</a> this page (:D:D) and you will be set for a while.</p>
            <p>So, here is what I have for you:</p>
            <h2 id="tip1">How to swap a git submodule with your own fork</h2>
            <p>This is a very common workflow: you start using someone else’s project as submodule but then after a while you find the need to customize it and tweak it yourself, so you want to fork the project and replace the submodule with your own fork. How is that done?</p>
            <p>The submodules are stored in <span class="text codecolorer">.gitmodules</span>:</p>
            <pre>
              <div class="codecolorer-container text mac-classic" style="overflow:auto;white-space:nowrap;width:600px;">
                <table cellspacing="0" cellpadding="0">
                  <tbody>
                    <tr>
                      <td class="line-numbers"><div>1<br>2<br>3<br>4<br></div></td>
                      <td><div class="text codecolorer">$ cat .gitmodules<br>
[submodule "ext/google-maps"]<br>
&nbsp; &nbsp; path = ext/google-maps<br>
&nbsp; &nbsp; url = git://git.naquadah.org/google-maps.git</div></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </pre>
            <p>You can just edit the url with a text editor and then run the following:</p>
            <pre>
              <div class="codecolorer-container text mac-classic" style="overflow:auto;white-space:nowrap;width:600px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br></div></td><td><div class="text codecolorer">$ git submodule sync</div></td></tr></tbody></table></div>

            </pre>
            <p>This updates <span class="text codecolorer">.git/config</span> which contains a copy of this submodule list (you could also just edit the relevant <span class="text codecolorer">[submodule]</span> section of <span class="text codecolorer">.git/config</span> manually).</p>
            <p>(<a href="http://stackoverflow.com/questions/11637175/swap-git-submodule-with-own-fork" target="_blank">Stack Overflow reference</a>)</p>
            <h2 id="tip2">How do I remove a submodule?</h2>
            <p>It is a fairly common need but has a slightly convoluted procedure. To remove a submodule you need to:</p>
            <ol>
              <li>Delete the relevant line from the <span class="text codecolorer">.gitmodules</span> file.</li>
              <li>Delete the relevant section from <span class="text codecolorer">.git/config</span>.</li>
              <li>Run <span class="text codecolorer">git rm –cached path_to_submodule</span> (no trailing slash).</li>
              <li>Commit and delete the now untracked submodule files.</li>
            </ol>
            <p>(<a href="http://stackoverflow.com/questions/1260748/how-do-i-remove-a-git-submodule" target="_blank">Stack Overflow reference</a>)</p>
            <h2 id="tip3">How do I integrate a submodule back into my project?</h2>
            <p>Or, in other words, how do I un-submodule a git submodule? If all you want is to put your submodule code into the main repository, you just need to remove the submodule and re-add the files into the main repo:</p>
            <ol>
              <li>Delete the reference to the submodule from the index, but keep the files:
                <pre>
                  <div class="codecolorer-container text mac-classic" style="overflow:auto;white-space:nowrap;width:600px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br></div></td><td><div class="text codecolorer">git rm --cached submodule_path (no trailing slash)</div></td></tr></tbody></table></div>

                </pre>
              </li>
              <li>
                <p>Delete the <span class="text codecolorer">.gitmodules</span> file <strong>or</strong> if you have more than one submodules<br>
                  edit this file removing the submodule from the list:</p>
                <pre>
                  <div class="codecolorer-container text mac-classic" style="overflow:auto;white-space:nowrap;width:600px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br></div></td><td><div class="text codecolorer">git rm .gitmodules</div></td></tr></tbody></table></div>

                </pre>
              </li>
              <li>Remove the <span class="text codecolorer">.git</span> metadata folder (<strong>make sure you have backup of this</strong>):
                <pre>
                  <div class="codecolorer-container text mac-classic" style="overflow:auto;white-space:nowrap;width:600px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br></div></td><td><div class="text codecolorer">rm -rf submodule_path/.git</div></td></tr></tbody></table></div>

                </pre>
              </li>
              <li>Add the <span class="text codecolorer">submodule</span> to the main repository index:
                <pre>
                  <div class="codecolorer-container text mac-classic" style="overflow:auto;white-space:nowrap;width:600px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br></div></td><td><div class="text codecolorer">git add submodule_path<br>
git commit -m "remove submodule"</div></td></tr></tbody></table></div>

                </pre>
              </li>
            </ol>
            <p><strong>NOTE:</strong> The procedure outlined above is <em>destructive</em> for the history of the submodule, in cases where you want to retain a congruent history of your submodules you have to work through a fancy “merge”. For more details I defer you to this very complete <a href="http://stackoverflow.com/questions/1759587/un-submodule-a-git-submodule" target="_blank">Stack Overflow reference</a>.</p>
            <h2 id="tip4">How to ignore changes in submodules</h2>
            <p>Sometimes your <span class="text codecolorer">submodules</span> might become <span class="text codecolorer">dirty</span> by themselves. For example if you use git <span class="text codecolorer">submodules</span> to track your vim plugins, they might generate or modify local files like <span class="text codecolorer">helptags</span>. Unfortunately, <a href="http://atlassian.com/git/tutorial/git-basics#!status" target="_blank"><span class="text codecolorer">git status</span></a> will start to annoy you about those changes, even though you are not interested in them at all, and you have no intention of committing them.</p>
            <p>The solution is very simple. Open the file <span class="text codecolorer">.gitmodules</span> at the root of your repository and for each submodule you want to ignore add <span class="text codecolorer">ignore = dirty</span>, like in this example:</p>
            <pre>
              <div class="codecolorer-container text mac-classic" style="overflow:auto;white-space:nowrap;width:600px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br></div></td><td><div class="text codecolorer">[submodule ".vim/bundle/msanders-snipmate"]<br>
&nbsp; path = .vim/bundle/msanders-snipmate<br>
&nbsp; url = git://github.com/msanders/snipmate.vim.git<br>
&nbsp; ignore = dirty</div></td></tr></tbody></table></div>

            </pre>
            <p>Thanks to <a href="http://www.nils-haldenwang.de/frameworks-and-tools/git/how-to-ignore-changes-in-git-submodules" target="_blank">Nils for the great explanation</a>.</p>
            <h2 id="tip5">Danger Zone! Pitfalls Interacting with Remotes</h2>
            <p>As the <a href="https://git.wiki.kernel.org/index.php/GitSubmoduleTutorial" target="_blank">Git Submodule Tutorial</a> on kernel.org reminds us there are a few important things to note when interacting with your remote repositories.</p>
            <p>The first is to <strong>always publish the submodule change before publishing the change to the superproject that references it</strong>. This is critical as it may hamper others from cloning the repository.</p>
            <p>The second is to always <strong>remember to commit all your changes before running <span class="text codecolorer">git submodule update</span></strong> as if there are changes they will be overwritten!</p>
            <h2 id="conclusions">Conclusions</h2>
            <p>Armed with these notes you should be able to tackle many common recurring workflows that come up when using submodules. In a future post I will write about alternatives to <span class="text codecolorer">git submodule</span>.</p>
            <p>Follow me <a href="http://twitter.com/durdn" target="_blank">@durdn</a> and the awesome <a href="http://twitter.com/AtlDevTools" target="_blank">@AtlDevtools</a> team for more DVCS rocking.</p>
          </div><!--/postcontent-->
        </article><!--/post-->
      </div><!--/content-->
    </div><!--/main-->
  </div><!--/page-->
</body>
</html>
